!function(){var t=$.param("userActId"),e=$.param("couponType"),n="paid_service_item"==e;if(!t)return $.tipShow("地址栏缺少参数！"),$.pageCancel();"true"==$.param("backPublic")&&$("#title>div:nth-of-type(2)").Click(function(t){t.stopImmediatePropagation(),history.back()});var o="../api/v2/club/userredpacket/"+t;n&&(o="../api/v2/club/user_paid_service_item/view"),$.ajax({url:o,isReplaceUrl:!0,data:{userType:"user",id:t},success:function(e){function o(){f++,$.ajax({url:y,isReplaceUrl:!0,data:{userActId:t,id:t},success:function(t){200==t.statusCode&&t.respData?v.src=t.respData:f<4&&o()}})}if(200!=e.statusCode)return $.tipShow(e.msg||"数据请求失败！"),$.pageCancel();e=e.respData;var i;if(n)e.userAct=e,$("#content>div:nth-of-type(3)>div:nth-of-type(3),#content>div:nth-of-type(3)>div:nth-of-type(4),#content>div:nth-of-type(3)>div:nth-of-type(5),#content>div:nth-of-type(3)>div:nth-of-type(6)").Class("hide"),$("#content>div:nth-of-type(4),#content>div:nth-of-type(6),#content>div:nth-of-type(7),#content>div:nth-of-type(8)").Class("hide"),$("#content>div:nth-of-type(3)>div:nth-of-type(7),#content>div:nth-of-type(3)>div:nth-of-type(8),#content>div:nth-of-type(3)>div:nth-of-type(9),#content>div:nth-of-type(3)>div:nth-of-type(10)").ClassClear("hide"),$(".rob-item").ClassClear("hide"),$("#content>div:nth-of-type(3)>div:nth-of-type(1)").Text(e.userAct.couponTypeName),$("#content>div:nth-of-type(3)>div:nth-of-type(2)").Text(e.userAct.actTitle),"credits"==e.userAct.paidType?$("#content>div:nth-of-type(3)>div:nth-of-type(7)>span").Text(e.userAct.credits+" 积分"):$("#content>div:nth-of-type(3)>div:nth-of-type(7)>span").Text(e.userAct.actValue+" 元"),$("#content>div:nth-of-type(3)>div:nth-of-type(8)>span").Text(e.userAct.couponPeriod.replace(/ \d{2}:\d{2}/g,"")),$("#content>div:nth-of-type(3)>div:nth-of-type(9)>span").Text(e.userAct.getDate),$("#content>div:nth-of-type(3)>div:nth-of-type(10)>span").Text(Math.round((new Date(e.userAct.useEndDate.split(" ")[0].replace(/-/g,"/")).getTime()-(new Date).getTime())/864e5)),"settled"==e.userAct.status?($("#content>div:nth-of-type(3)>div:nth-of-type(10)").Text("已使用"),$("#content>div:nth-of-type(5)").CSS("display","none")):"",$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)>span").Text(e.userAct.useStartDate.split(" ")[0]+" - "+e.userAct.useEndDate.split(" ")[0]),$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Html(e.userAct.actContent),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").CSS("background-image","url("+e.userAct.imageUrl+")"),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(e.userAct.actTitle),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(1)").Text(e.userAct.price+"元/"+e.userAct.duration+e.userAct.durationUnit),e.userAct.pricePlus&&$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(2)").Text(e.userAct.pricePlus+"元/"+e.userAct.durationPlus+e.userAct.durationUnitPlus),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Html(e.userAct.description||"无");else{var p="money"==e.userAct.useType,c="redpack"==e.userAct.couponType;if($("#content>div:nth-of-type(3)>div:nth-of-type(1)").Text(e.userAct.useTypeName),$("#content>div:nth-of-type(3)>div:nth-of-type(2)").Text(p?e.userAct.actValue+"元":e.userAct.actTitle),p&&0==e.userAct.consumeMoney?$("#content>div:nth-of-type(3)>div:nth-of-type(3)").CSS("display","none"):$("#content>div:nth-of-type(3)>div:nth-of-type(3)").Text(e.userAct.consumeMoneyDescription),$("#content>div:nth-of-type(3)>div:nth-of-type(4)>span").Text(e.userAct.couponPeriod),$("#content>div:nth-of-type(3)>div:nth-of-type(5)>span").Text(e.userAct.getDate),c?$("#content>div:nth-of-type(3)>div:nth-of-type(6)>span").Text(e.userAct.canUseSum+"次"):($("#content>div:nth-of-type(3)>div:nth-of-type(6)").CSS("display","none"),$("#content>div:nth-of-type(4)").CSS("display","none"),$("#content>div:nth-of-type(6)").CSS("display","none")),p||!e.userAct.actDescription?$("#content>div:nth-of-type(7)").CSS("display","none"):(e.userAct.actDescription&&0!=e.userAct.actDescription.length||(e.userAct.actDescription="无"),$("#content>div:nth-of-type(7)>div:nth-of-type(2)").Html(e.userAct.actDescription)),e.phoneNums_get&&e.phoneNums_get.length>0||e.phoneNums_use&&e.phoneNums_use.length>0){var s,a="",u=p?e.userAct.actValue+"元"+e.userAct.useTypeName:e.userAct.actTitle;if(e.phoneNums_get)for(s=0;s<e.phoneNums_get.length;s++)a+="<li>"+e.phoneNums_get[s].phone+"<div>已经领取"+u+"<span>"+e.phoneNums_get[s].date+"</span></div></li>";if(e.phoneNums_use)for(s=0;s<e.phoneNums_use.length;s++)a+="<li>"+e.phoneNums_use[s].phone+"<div>已经使用"+u+"<span>"+e.phoneNums_use[s].date+"</span></div></li>";$("#content>div:nth-of-type(6)>ul").Html(a)}else $("#content>div:nth-of-type(6)").CSS("display","none");e.userAct.actContent&&0!=e.userAct.actContent.length||(e.userAct.actContent="无"),$("#content>div:nth-of-type(8)>div:nth-of-type(2)").Text("券有效期："+e.userAct.couponPeriod),$("#content>div:nth-of-type(8)>div:nth-of-type(3)").Text("使用时段："+e.userAct.useTimePeriod),$("#content>div:nth-of-type(8)>div:nth-of-type(4)").Html("<div></div>"+e.userAct.actContent);var d=[];e.items=e.items||[];for(var s=0;s<e.items.length;s++)d.push(e.items[s].name);d.length>0&&$("#content>div:nth-of-type(8)>div:nth-of-type(4)>div").Html("使用项目：仅限"+d.join("，"));var r=$("#content>div:nth-of-type(4)>div");if(("1"!=e.userAct.couponStatus&&"2"!=e.userAct.couponStatus||!e.shareUrl)&&r.Class("unwork"),i=!($.$.ua.isWX&&!r.ClassHave("unwork")),c){var h=$("#show-coupons-pop");$("#show-coupons-pop>div:nth-of-type(2)>div:nth-of-type(3)").Click(function(){h.ClassClear("active")}),h.Click(function(){h.ClassClear("active")}),$("#show-coupons-pop>div:nth-of-type(2)").Click(function(t){t.stopPropagation()}),$("#show-coupons-pop>div:nth-of-type(1)").Click(function(t){t.stopPropagation()}),$("#show-coupons-pop>div:nth-of-type(2)>div:nth-of-type(1)").Html("<a href='"+e.shareUrl+"'>"+e.shareUrl+"</a>"),$.$.ua.isWX?$("#show-coupons-pop>div:nth-of-type(1)").CSS("display","block"):$("#show-coupons-pop>div:nth-of-type(2)").CSS("display","block"),r.ClassHave("unwork")?r.Click(function(){$.tipShow("活动已过期！不可分享！")}):r.Click(function(){h.Class("active")})}i||$.X5Config({title:e.clubName+"-"+(p?e.userAct.actValue+"元"+e.userAct.useTypeName:e.userAct.actTitle),desc:c?"此券可在"+e.clubName+"使用，分享给朋友获得更多优惠。":"送你一张优惠券，带上它，让你的身体爽一把。",link:e.shareUrl,imgUrl:e.imageUrl,success:function(){h.ClassClear("act"),$.ajax({url:($.$.clubID?"../":"")+"/redpacket/share",data:{userActId:t},success:function(t){"200"==t.statusCode&&h.ClassClear("active")}})},cancel:function(){},fail:function(t){$.tipShow("分享失败！请稍后再试！")}})}$("#content>div:nth-of-type(2)").Text(e.clubName);var v=$("#content>div:nth-of-type(5)>img")[0];v.onload=function(){v.style.opacity="1"};var f=0,y="../api/v2/club/user/coupon_qrcode";n&&(y="../api/v2/club/user_paid_service_item/qrcode"),e.userAct.couponQrCodeUrl||e.userAct.qrCodeUrl?v.src=e.userAct.couponQrCodeUrl||e.userAct.qrCodeUrl:o(),$("#content>div:nth-of-type(5)>span").Text(e.userAct.couponNo.substr(0,4)+" "+e.userAct.couponNo.substr(4,4)+" "+e.userAct.couponNo.substr(8)),i?$.pageSwitch(i):$.pageSwitch()}})}();