!function(){function e(e,a){d||(d=!0,r=e||r+1,p.ClassClear("none"),g.Class("none"),u=!1,$.ajax({url:"../api/v1/emchat/friendlist/"+$.$.easemob.userId,isReplaceUrl:!0,data:{channel:"center",page:r,pageSize:b},success:function(e){if("200"!=e.statusCode)return $.tipShow(e.msg||"数据请求失败！");e=e.respData,c="";var i,l,v,f;for(n=0,s=e.length;n<s;n++)(!$.$.clubID||e[n].clubId&&e[n].clubId==$.$.clubID)&&(i=new Date,l=e[n].chatDate.split(" "),v=l[1].split(":"),l=l[0].split("-"),i.setFullYear(l[0]-0,l[1]-1,l[2]-0),i.setHours(v[0]-0,v[1]-0,v[2]-0),o=y[e[n].friendChatId],f=e[n].friendDescription||"",o&&(f=t(o.msg.data.replace(/<br>|<br\/>/g,"")),i=o.time),c+="<div data-chat-Id='"+e[n].friendChatId+"' data-target-Id='"+e[n].friendUserId+"'  data-club-Id='"+(e[n].clubId||"")+"'  data-friend-Name='"+(e[n].friendName||"")+"' data-to-type='"+e[n].toType+"' data-header='"+e[n].friendAvatarUrl+"'>                                <div style='background-image: url("+(e[n].friendAvatarUrl||("manager"==e[n].toType?$.$.defaultClubLogo:$.$.defaultHeader))+")'></div>                                <div>                                    <div>"+e[n].friendName+(e[n].techNo&&e[n].techNo.length>0?"<span><span>[</span>"+e[n].techNo+"<span>]</span></span>":"")+"</div>                                    <div>"+f+"</div>                                    <div>"+$.formatMsgTime(i)+"</div>                                </div><div class='delete-msg'>删除记录</div>                         </div>");1==r?(h.Html(c),c?_.style.display="none":(_.style.display="block",u=!0),I=h[0].scrollHeight):(h.Html(c,!0),s<b&&(u=!0,g.ClassClear("none"))),d=!1,p.Class("none"),a&&a()}}))}function t(e){return e.replace(i,function(){return T[arguments[0]]||arguments[0]})}function a(e){$.sessionStorage("contacts_data",h.Html()),$.sessionStorage("contacts_page",r),$.sessionStorage("contacts_page_height",I),$.sessionStorage("contacts_end",u),$.sessionStorage("contacts_top",v[0].scrollTop);var t=e.parentNode.dataset,a=t.chatId,n=t.targetId,s=t.clubId,i=t.toType;if("tech"==i)$.page("chat&techId="+n+"&clubId="+s);else if("manager"==i){var o=$.getSessionList(!1,!0)[a]||{name:e.parentNode.getAttribute("data-friend-name"),header:t.header||$.$.defaultClubLogo,avatar:"",clubId:s};$.$.easemob.currChatTech={chatId:a,name:o.name,header:o.header,avatar:o.avatar,clubId:o.clubId,clubName:"",techId:"",inviteCode:"",no:"",appointment:"n",phoneAppointment:"n",telephone:"",chatName:"",chatHeader:""},$.page("chat&techId="+(o.techId||"")+($.$.clubID?"":"&clubId="+o.clubId))}}var n,s,i,o,l=$("#title>div:nth-of-type(1)>div"),c="",d=!1,r=1,p=$("#loadTip"),g=$("#finishTip"),u="true"==($.sessionStorage("coupon_end")||"false"),h=$("#content>div.list"),v=$("#content"),f=$.sessionStorage("coupon_top"),C=$.sessionStorage("coupon_page"),m=$.sessionStorage("coupon_data"),I=$.sessionStorage("page_height")||0,b=10,S=.4,_=$("#content>div.nullData")[0],y=$.getSessionList(!1,!0),T={"/::O":"/大笑","/::Y":"/坏笑","/::B":"/害羞","/::A":"/色","/::C":"/晕","/::D":"/红心","/::X":"/心碎了","/::Z":"/握手","/::F":"/抱拳","/::E":"/花","/::T":"/花谢了","/::P":"/示爱","/::G":"/亲亲","/::H":"/大哭","/::I":"/可怜","/::J":"/生气","/::K":"/微笑","/::L":"/冷汗","/::M":"/困","/::N":"/调皮","/::Q":"/敲打","/::R":"/疑问","/::S":"/猪头","/::U":"/汽水","/::V":"/西瓜","/::W":"/鼓掌","/::a":"/大拇指","/::b":"/剪刀手"};i=new RegExp("/::[A-Zab]+","g"),$.pageSwitch(!0,!0),v.Event("scroll",function(t){!u&&v[0].scrollTop+v[0].clientHeight-(r+S-1)*I>=0&&e()}),$("#content").Delegate("click",">div.list>div>div:nth-of-type(1),>div.list>div>div:nth-of-type(2)",function(e,t){a(t)}),l.Event("click",function(e,t){var a=$(t);a.ClassHave("edit-title")?($(".delete-msg").Class("active"),a.ClassClear("edit-title"),a.Class("complete-title"),a.Text("完成")):(a.ClassClear("complete-title"),a.Class("edit-title"),$(".delete-msg").ClassClear("active"),a.Text("编辑"))}),$("#content").Delegate("click",">div.list .delete-msg",function(e,t,a){e.preventDefault();var n=$(t.parentNode),s=n.Attr("data-chat-id"),i=$("#content>div.list")[0];$.ajax({url:"../api/v1/emchat/friend",isReplaceUrl:!0,type:"post",data:{channel:"center",currentChatId:$.$.easemob.userId,showFlag:"n",friendChatId:s},success:function(e){return"200"!=e.statusCode?$.tipShow(e.msg||"请求失败！"):(i.removeChild(n[0]),void(0==$(i).Children().length&&(_.style.display="block",l[0].click())))}})}),$("#title>div:nth-of-type(2)>a").Click(function(e,t){$.page("",-1)}),m?(r=parseInt(C),h.Html(m),setTimeout(function(){v[0].scrollTop=f},1),setListClick(),u&&g.ClassClear("none"),$.pageSwitch()):e(1,function(){$.pageSwitch()}),$.sessionStorageClear("contacts_data"),$.sessionStorageClear("contacts_end"),$.sessionStorageClear("contacts_top"),$.sessionStorageClear("contacts_page"),$.sessionStorageClear("contacts_page_height")}();