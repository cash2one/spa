!function(e){function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function a(e,n,i){function o(e){for(var n in e)e.hasOwnProperty(n)&&(t(e[n])?s[n]=a(s[n],e[n]):s[n]=e[n])}if(0==Object.keys(n).length)return e;var s,e=t(e)?e:{};return i=i!==!1,s=i?{}:e,i&&o(e),o(n),s}function n(e){function t(e){var t=e.getBoundingClientRect(),a=document.documentElement.clientTop,n=document.documentElement.clientLeft;return{top:t.top-a,right:t.right-n,bottom:t.bottom-a,left:t.left-n,width:t.width}}function n(e,t,a,n){var i=g.children[e],n=!1!==n,o=i&&i.style;o&&(o.webkitTransitionDuration=o.MozTransitionDuration=o.msTransitionDuration=o.OTransitionDuration=o.transitionDuration=a+"ms",o.webkitTransform="translate("+t+"px,0)translateZ(0)",o.msTransform=o.MozTransform=o.OTransform="translateX("+t+"px)",n||setTimeout(function(){o.webkitTransform="translate("+t+"px,0)"},a),y[e]=t)}function i(e){return(C.length+e%C.length)%C.length}function o(t,a){var o=C[i(t)],s=o.dataset.index-0,l=C[i(s-1)],d=l.dataset.index,r=y[s];return s-1>=0?(n(d,-e.oneEleWidth+parseFloat(x[s]||0),0),y[d]=r):(n(d,parseFloat(o.dataset.tx||0)-parseFloat(l.dataset.tx||0)-e.oneEleWidth+parseFloat(x[s]||0),0),y[d]=-e.oneEleWidth-parseFloat(l.dataset.tx||0)+r),d}function s(t,a){var o=C[i(t)],s=o.dataset.index-0,l=C[i(s+1)],d=l.dataset.index,r=y[s];return s+1<C.length?(n(d,e.oneEleWidth+parseFloat(x[s]||0),0),y[d]=r):(n(d,e.oneEleWidth+parseFloat(x[s]||0)+parseFloat(o.dataset.tx||0)+parseFloat(l.dataset.tx||0),0),y[d]=e.oneEleWidth+parseFloat(o.dataset.tx||0)+r),d}function l(t,a,s,l){var d=e.index+e.showEleCount-t+2,r=[];y[i(d)]=(C[i(d)].dataset.currentTx||0)-0+a,r[i(d)];for(var c=d,h=e.index-t;c>=h;c--)r.push(o(c,s));r.forEach(function(e){n(e,y[e],s,l)})}function d(t,a,o,l){var d=t+e.index+e.showEleCount+1,r=e.index-1,c=[];y[i(r)]=(C[i(r)].dataset.currentTx||0)-0+a,c.push(i(r));for(var h=r,p=d;h<=p;h++)c.push(s(h,o));c.forEach(function(e){n(e,y[e],o,l)})}function r(e){var t=e.touches[0];v={x:t.clientX,y:t.clientY,time:+new Date},b=!0,$=void 0,f={},g.addEventListener("touchmove",c,!1),g.addEventListener("touchend",h,!1),g.addEventListener("touchcancel",h,!1)}function c(t){var n=t.touches[0];if(f={x:n.clientX-v.x,y:n.clientY-v.y},"undefined"==typeof $&&($=!!(Math.abs(f.x)>Math.abs(f.y))),$){t.preventDefault(),m=Math.ceil(f.x/e.oneEleWidth);var i=Math.abs(m);f.x<0?d(i,f.x,0):l(i,f.x,0),b=!1}x=a({},y)}function h(t){if($){w+=f.x;for(var a=0,n=C.length;a<n;a++)C[a].dataset.currentTx=y[a]||0;e.index=i(Math.ceil(-w/e.oneEleWidth)-1);var o=-C[e.index].dataset.tx-y[e.index];S=!0,f.x<0?Math.abs(o)>e.oneEleWidth/2?(o-=e.oneEleWidth,l(0,o,300,!1)):d(0,o,300,!1):l(0,o,300,!1),setTimeout(function(){S=!1},300),w+=o;for(var a=0,n=C.length;a<n;a++)C[a].dataset.currentTx=y[a]||0;e.index=i(Math.ceil(-w/e.oneEleWidth)),g.dataset.index=e.index,g.dataset.moveTotal=w,g.removeEventListener("touchmove",c,!1),g.removeEventListener("touchend",h,!1),g.removeEventListener("touchcancel",h,!1)}}function p(){if(S){for(var e=0,t=C.length;e<t;e++){var a=C[e].style;a.webkitTransitionDuration=a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration="0ms"}S=!1}}function u(){}var v,f,g,$,C,m,y={},x={},b=!1,w=0,S=!1,I=new u;if(e=a({container:null,callback:function(){},transitionEnd:null,oneEleWidth:0,index:0,showEleCount:1},e),!e.container)throw new Error("ScrollHori 窗器不能为空。");if(1!=e.container.dataset.hasScroll){if(g=e.container,g.dataset.hasScroll=!0,e.container.children.length<e.showEleCount)return void console.info("无需滚动");g.children.length<2*e.showEleCount&&(g.innerHTML+=g.innerHTML),C=g.children;var E=getComputedStyle(C[0]);e.oneEleWidth=e.oneEleWidth||(t(C[0]).width||C[0].offsetWidth||parseFloat(E.width))+parseFloat(E.marginLeft)+parseFloat(E.marginRight);for(var T=0,L=C.length;T<L;T++)C[T].dataset.tx=T*e.oneEleWidth,C[T].dataset.index=T;if("undefined"!=typeof g.dataset.index){for(var T=0,L=C.length;T<L;T++)y[T]=C[T].dataset.currentTx-0;e.index=g.dataset.index-0,w=g.dataset.moveTotal-0}else n(C.length-1,-C.length*e.oneEleWidth,0,!1),C[C.length-1].dataset.currentTx=-C.length*e.oneEleWidth,y[C.length-1]=-C.length*e.oneEleWidth;return x=a({},y),g.addEventListener("touchstart",r,!1),u.prototype.stopAnimation=p,I}}e.scrollHori=n}(window),function(){function e(){E=$("#content div.fourth-page>div.list"),T=$("#content div.fourth-page>div:nth-of-type(3)"),L=$("#content div.fourth-page>div:nth-of-type(3)>span"),k=$("#content div.fourth-page>div:nth-of-type(3)>img"),D=$("#content div.fourth-page>div:nth-of-type(4)"),U=$("div#content>div:nth-of-type(1)>div:nth-of-type(1)>div:last-child"),R=$("#searchArea>div:nth-of-type(3)"),_=$("#searchArea input"),j=$("#searchArea"),H=$("#searchArea>div:nth-of-type(2)"),B=$("#content div.fifth-page>div.list"),Z=$("#content div.fifth-page>div:nth-of-type(2)"),q=$("#content div.fifth-page>div:nth-of-type(3)"),O=$(".show-area"),I=$("div#content div.fourth-page>div:nth-of-type(1)>div")}function t(){var e,t,n=new AMap.LngLat($.$.currLngx,$.$.currLaty);e=new AMap.Map("mapInfo",{resizeEnable:!1,view:new AMap.View2D({zoom:15,center:n})}),e.plugin(["AMap.Geocoder"],function(){t=new AMap.Geocoder({radius:1e3,extensions:"all"}),AMap.event.addListener(t,"complete",a),t.getAddress(n)})}function a(e){X=e.regeocode.addressComponent.city||e.regeocode.addressComponent.province,J=e.regeocode.addressComponent.district,r()}function n(e){O.Children().Class("hide").Index(e-1).ClassClear("hide")}function i(){function t(){if(W=F=z?4:1,n(F),$.param("search_text")&&(a(),_[0].value=decodeURIComponent($.param("search_text")),P=!1),1==W)s();else if(4==W){b=0,$(".fourth-page>div:nth-of-type(1)>div:nth-of-type(1)>span").Text("全部会所");var e=$(".fourth-page>div:nth-of-type(1)>div:nth-of-type(1)>ul>li").ClassClear("selected");e.Index(e.length-1).Class("selected"),o()}d()}function a(){j.Class("active"),F=2,n(F)}function i(){_.Value().trim()?(V=_.Value().trim(),2==F||3==F?($(".third-page>div:nth-of-type(3)").ClassClear("hide"),$(".third-page>div:nth-of-type(1),.third-page>div:nth-of-type(2)").Class("hide"),F=3,n(F),c(!0)):(F=5,n(F),h(!0))):3==F&&(F=2,n(F))}"none"==$("#_publicMenu",!0)[0].style.display&&($("#_publicMenu",!0)[0].style.display="block",$("#_publicMenu>.clubList",!0).Class("active"),$("#content",!0).ClassClear("noneMenu"));for(var r=0,p=ee.length-1;r<p;r++)$.localStorageClear(ee[r]);if(ee=ee.slice(ee.length-1)||[],te&&Date.now()-parseInt(te,36)<18e5){ae=$.localStorage(te),$.localStorageClear(te);try{ae=JSON.parse(ae),W=ae.initShowPageIndex,F=ae.showPageIndex,$("#content").Html(ae.data),e(),Q=ae.searchType5,_[0].value=ae.searchText,setTimeout(function(){$("#content")[0].scrollTop=ae.scrollTop},10),$(".has-event").ClassClear("has-event"),l()}catch(u){ae=null,t()}}else t();U.Event("click",a),H.Event("click",function(){j.ClassClear("active"),n(W),_[0].value=""}),R.Click(function(){i()}),$("div#content>div:nth-of-type(1)>div:nth-of-type(1)>div:first-child").Click(function(){$.page("inviteCode&tmp_clubSource=9358")}),T.Click(function(){o()}),Z.Click(function(){h()}),$("#content").Event("scroll",function(e,t){t.scrollTop+1.4*$.$.winHeight>t.scrollHeight&&(4!=F||M?5!=F||K||h():o())}),"Y"!=$.$.isLogin&&(T.CSS("display","none"),E.Class("nodata")),I.Click(function(e,t){var a="active"==t.className;a?t.className="":(I.ClassClear("active"),t.className="active")}),$("div#content div.fourth-page>div:nth-of-type(1) ul>li").Event("click",function(e,t){if("selected"!=t.className){switch($(t.parentNode).Children().ClassClear("selected"),t.className="selected",$(t.parentNode.parentNode).Children().Index(0).Text($(t).Text()),t.parentNode.dataset.type){case"distance":b=t.dataset.item;break;case"sortField":w=t.dataset.item;break;case"filter":S=t.dataset.item}E.ClassClear("nodata"),y=1,M=!1,o()}}),$("div.first-page>div:first-child,div.first-page>div:nth-of-type(4)").Click(function(){E.ClassClear("nodata"),y=1,M=!1,o(),F=4,n(F),$("#showListTitle").ClassClear("hide")}),$("#showListTitle a").Click(function(){$("#showListTitle").Class("hide"),F=W,n(F)}),$(".second-page>div>div:last-child").Delegate("click",">div>div",function(e,t){_[0].value=$(t).Text(),i()}),$(".third-page>div:nth-of-type(1)>div:last-child").Click(function(){Q="club",h(!0),F=5,n(F)}),$(".third-page>div:nth-of-type(2)>div:last-child").Click(function(){Q="tech",h(!0),F=5,n(F)}),$("#content").Delegate("click",".tech-item>div:nth-of-type(2)>div",function(e,t){e.stopPropagation(),e.stopImmediatePropagation(),g(t.dataset.clubId,"technicianDetail&id="+t.dataset.techId)}).Delegate("click",".tech-item>div:nth-of-type(1)",function(e,t){e.stopPropagation(),e.stopImmediatePropagation(),g(t.dataset.clubId)}),$("#content").Event("touchstart",function(e){ne.forEach(function(e){e.stopAnimation()})})}function o(){if(le){if(re||ce)return}else if(M||A)return;le?ce=!0:A=!0,D.CSS("display","none"),T.CSS("display","block"),L.Text("正在加载"),k.CSS("visibility","visible"),$("#content").ClassClear("over");var e="../api/v2/club/all/clubs";e=le?"../api/v1/wx/visit_clubs/search":e,$.ajax({url:e,isReplaceUrl:!0,type:"get",data:{clubName:encodeURIComponent(encodeURIComponent(_.Value())),pageSize:x,page:le?de:y,openId:$.$.openId,distance:b,sort:w,loginName:$.$.userLoginName,lngx:$.$.currLngx||"",laty:$.$.currLaty||"",search:"all"==S?"":S},success:function(e){if("200"==e.statusCode){L.Text("点击加载更多"),k.CSS("visibility","hidden");var t="";for(C=0;C<e.respData.length;C++)m.push(e.respData[C]);t=p(e.respData).join("");var a=le?de:y;1==a?0==e.respData.length?(E.Class("nodata"),le?re=!0:M=!0):(E.ClassClear("nodata"),E.Html(t)):E.Html(t,!0),e.respData.length<x?(T.CSS("display","none"),(1!=a||1==a&&e.respData.length>0)&&(D.CSS("display","block"),$("#content").Class("over"),le?re=!0:M=!0)):(T.CSS("display","block"),le?de++:y++),$(".fourth-page .has-event").ClassClear("has-event"),l()}else e.msg&&($.tipShow(e.msg||"请求会所列表数据失败！"),0==E.Html().length&&(T.CSS("display","none"),E.Class("nodata"),le?re=!0:M=!0));le?ce=!1:A=!1},error:function(e){le?ce=!1:A=!1}})}function s(){$.ajax({url:"../api/v2/club/near/clubs",isReplaceUrl:!0,data:{lngx:$.$.currLngx||"",laty:$.$.currLaty||""},success:function(e){if(200==e.statusCode){e=e.respData||[];var t=p(e);0==t.length?($("#firstClubList").Class("nodata"),$(".first-page>div:nth-of-type(4)").Class("hide")):($("#firstClubList").Html(t.join("")),$(".first-page>div:nth-of-type(4)").ClassClear("hide")),l()}else $.tipShow(e.msg||"查询附近会所失败");$(".first-page>div:nth-of-type(1),.first-page>div:nth-of-type(2)").ClassClear("hide"),$(".first-page>div:nth-of-type(3)").Class("hide")}})}function l(){$("#content>div.show-area .club-item-list.has-techs>div:last-child>div").Each(function(e){var t=scrollHori({container:e,showEleCount:4});t&&ne.push(t)}),$(".club-item-list>div:first-child>div>div:first-child>span:nth-of-type(2):not(.has-event)").Click(function(e,t){e.stopPropagation(),g(t.dataset.clubId,"promotions")}).Class("has-event"),$(".club-item-list>div:first-child:not(.has-event)").Click(function(e,t){e.stopPropagation(),g(t.dataset.clubId)}).Class("has-event"),$(".club-item-list>div:last-child>div>div:not(.has-event)").Click(function(e,t){e.stopPropagation(),g(t.dataset.clubId,"technicianDetail&id="+t.dataset.techId)}).Class("has-event")}function d(){$.ajax({url:"../api/v2/club/impression/list",isReplaceUrl:!0,data:{},success:function(e){200!=e.statusCode&&$.tipShow(e.msg||"查询印象标签数据出错");var t=[];e.respData.forEach(function(e){t.push("<div>"+e.tag+"</div>")}),$(".second-page>div:nth-of-type(2)>div:last-child>div").Html(t.join(""))}})}function r(){$.ajax({url:"../api/v2/club/tags",isReplaceUrl:!0,type:"post",data:{city:encodeURIComponent(X||""),region:encodeURIComponent(J||""),laty:$.$.currLaty||0,lngx:$.$.currLngx||0},success:function(e){200==e.statusCode?e.respData&&Array.isArray(e.respData)&&$(".second-page>div:nth-of-type(1)>div:last-child>div").Html("<div>"+e.respData.join("</div><div>")+"</div>"):$.tipShow(e.msg||"查询会所标签数据出错")}})}function c(){$(".third-page").ClassClear("nodata"),$.ajax({url:"../api/v2/club/club_tech_search",isReplaceUrl:!0,type:"post",data:{laty:$.$.currLaty||"",lngx:$.$.currLngx||"",page:1,pageSize:3,search:encodeURIComponent(V),searchType:""},success:function(e){if(200==e.statusCode){e=e.respData;var t=[],a=[];t=p(e.clubs||[]),a=u(e.techs||[]),0==a.length&&0==t.length?$(".third-page").Class("nodata"):(t.length>0&&($(".third-page>div:nth-of-type(1)").ClassClear("hide"),$(".third-page>div:nth-of-type(1)>div:nth-of-type(2)").Html(t.join("")),l()),a.length>0&&($(".third-page>div:nth-of-type(2)").ClassClear("hide"),$(".third-page>div:nth-of-type(2)>div:nth-of-type(2)").Html(a.join(""))))}else $(".third-page").Class("nodata"),$.tipShow(e.msg||"");$(".third-page>div:nth-of-type(3)").Class("hide")}})}function h(e){e&&(Y=0,K=!1,B.Html("")),Y++,Z.ClassClear("hide"),q.Class("hide"),$.ajax({url:"../api/v2/club/club_tech_search",isReplaceUrl:!0,type:"post",data:{laty:$.$.currLaty||"",lngx:$.$.currLngx||"",page:Y,pageSize:G,search:encodeURIComponent(V),searchType:Q},success:function(e){if(200==e.statusCode){e=e.respData;var t=[],a=0;$(".fifth-page .has-event").ClassClear("has-event"),"club"==Q?(e.clubs||(e.clubs=[]),a=e.clubs.length,t=p(e.clubs)):(e.techs||(e.techs=[]),a=e.techs.length,t=u(e.techs||[])),0==t.length?1==Y?($(".fifth-page").Class("nodata"),q.Class("hide")):(K=!0,q.ClassClear("hide")):($(".fifth-page").ClassClear("nodata"),B.Html(t.join(""),!0),a<G&&(K=!0,q.ClassClear("hide")),l())}else $(".fifth-page").Class("nodata"),$.tipShow(e.msg||"");Z.Class("hide")}})}function p(e){var t,a=[];return e.forEach(function(e,n){t=e.distance&&Number.MAX_VALUE!=e.distance?v(e.distance):"-米",e.distance=t,e.imageUrl&&0!=e.imageUrl.length||(e.imageUrl="img/logo_default.jpg"),a.push('<div class="club-item-list '+(e.techs&&e.techs.length>0?"has-techs":"no-techs")+'">                                        <div data-club-id="'+e.id+'">                                            <i style="background-image: url('+(e.imageUrl||$.$.defaultClubLogo)+')"></i>                                            <div>                                                <div><span>'+e.name+"</span><span "+(e.couponCount>0?"":'class="hide"')+' data-club-id="'+e.id+'">抢优惠</span>                                                </div>                                                <div><span>'+e.address+"</span><span>"+t+"</span>                                                </div>                                            </div>                                        </div><div>                                        "+(e.techs&&e.techs.length>0?"                                            <div>                                            "+function(t){var a=[];return t.forEach(function(t){a.push('<div data-club-id="'+e.id+'" data-tech-id="'+t.id+'">                                                                        <div style="background-image: url('+(t.avatarUrl||$.$.defaultHeader)+')"></div>                                                                        <div><span>'+t.name+"</span><span>"+(t.star/20).toFixed(1)+"</span>                                                                        </div>                                                                        <div>"+t.orderCount+" 人约</div>                                                                    </div>")}),a.join("")}(e.techs)+"</div>":"")+"                                    </div></div>")}),a}function u(e){var t=[];return e.forEach(function(e){t.push('<div class="tech-item">                                        <div data-club-id="'+e.id+'"><div><div style="background-image:url('+(e.imageUrl||$.$.defaultClubLogo)+')"></div></div>                                            <div>                                                <div>'+e.name.replace(new RegExp(V,"g"),'<span class="key-words">'+V+"</span>")+"</div>                                            </div>                                            <div>"+v(e.distance)+"</div>                                        </div>                                        <div>"+function(e){var t=[];return e.forEach(function(e){t.push('<div data-club-id="'+e.clubId+'" data-tech-id="'+e.techId+'">                                                                                                <div><div style="background-image: url('+(e.avatarUrl||$.$.defaultHeader)+')"></div></div>                                                                                                <div>                                                                                                    <div><div>'+(e.name||$.$.defaultTechName).replace(new RegExp(V,"g"),'<span class="key-words">'+V+"</span>")+'</div><div><span>                                                                                                            <span><span style="width:'+e.star+'%"></span></span>'+e.commentCount+" 评论</span>                                                                                                    </div></div>                                                                                                    <div><span>"+e.tag.replace(new RegExp(V,"g"),'<span class="key-words">'+V+"</span>").replace(/,/g,"，</span><span>")+"</span></div>                                                                                                </div>                                                                                            </div>")}),t.join("")}(e.techImpression)+"                                        </div>                                    </div>")}),t}function v(e){return e=1e3*parseFloat(e,10),isNaN(e)||1e9==e?"- 米":e>1e3?(e/1e3).toFixed(1)+"千米":e.toFixed(0)+"米"}function f(){return te=Date.now().toString(36),se={initShowPageIndex:W,showPageIndex:F,scrollTop:$("#content")[0].scrollTop,searchType5:Q,searchText:_.Value(),data:$("#content").Html()},ee.push(te),$.localStorage("9358_club_list_cache_list",JSON.stringify(ee)),$.localStorage(te,JSON.stringify(se)),$.paramClear("clubListReadCache"),$.param("clubListReadCache",te),te}function g(e,t){t=t||"home",location.href=he+e+"#"+t+("9358"==$.$.visitChannel?"&visitChannel=9358":"")+"&clubListReadCache="+f()}var C,m=[],y=1,x=20,b=30,w="",S="all",I=$("div#content div.fourth-page>div:nth-of-type(1)>div"),E=$("#content div.fourth-page>div.list"),T=$("#content div.fourth-page>div:nth-of-type(3)"),L=$("#content div.fourth-page>div:nth-of-type(3)>span"),k=$("#content div.fourth-page>div:nth-of-type(3)>img"),D=$("#content div.fourth-page>div:nth-of-type(4)"),M=!1,A=!1,U=$("div#content>div:nth-of-type(1)>div:nth-of-type(1)>div:last-child"),R=$("#searchArea>div:nth-of-type(3)"),_=$("#searchArea input"),j=$("#searchArea"),H=$("#searchArea>div:nth-of-type(2)"),N=$.param("code")||$.getUrlParam("code"),P=!0,W=$.localStorage("viewClubType")||$.param("showPageIndex")||$.getUrlParam("showPageIndex")||1,F=$.param("showPageIndex")||$.getUrlParam("showPageIndex")||W,O=$(".show-area"),z=4==$.localStorage("viewClubType"),V="",X="",J="",Y=1,G=10,B=$("#content div.fifth-page>div.list"),Z=$("#content div.fifth-page>div:nth-of-type(2)"),q=$("#content div.fifth-page>div:nth-of-type(3)"),K=!1,Q="club",ee=JSON.parse($.localStorage("9358_club_list_cache_list")||"[]")||[],te=$.getUrlParam("clubListReadCache")||!1,ae=null,ne=[];if($.$.ua.isWX&&(!$.$.openId||$.$.openId.length<10)){if(!N)return void $.getOauthCode("","9358","9358","base");$.ajax({url:($.$.clubID?"../":"")+"../wx/oauth2/openid",data:{code:N,scope:"snsapi_base",sessionType:"9358",openId:$.$.payOpenId||"",webSessionId:$.$.paySessionId||""},success:function(e){if(200==e.statusCode)$.$.openId=e.respData.openid,$.$.payOpenId=e.respData.openid,$.$.paySessionId=e.respData.sessionId,$.localStorage("openId",$.$.openId),$.localStorage("payOpenId",$.$.payOpenId),$.localStorage("paySessionId",$.$.paySessionId),i(),$.pageSwitch();else{if("40029"!=e.statusCode)return $.tipShow(e.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","9358","base")}}})}else i(),$.pageSwitch();if($.$.currLngx&&$.$.currLaty)if(AMap&&AMap.LngLat)t();else var ie=0,oe=setInterval(function(){ie++,AMap&&AMap.LngLat?(clearInterval(oe),t()):ie>30&&(clearInterval(oe),$.tipShow("高德地图初始化失败！"))},150);else $.tipShow("请打开“9358”公众号的位置信息");var se="",le=!1,de=1,re=!1,ce=!1,he=location.origin+location.pathname+"?club="}();