!function(){function e(){i[0]&&i[1]&&i[2]?l.Class("active"):l.ClassClear("active"),i[0]?c.CSS("display","none"):c.CSS("display","block")}function a(){var e=$.$.easemob,a=!1;e.conn.isClosed()||(a=!0,e.conn.stopHeartBeat(e.conn),e.conn.close(),e.currChatTech={},e.sessionList=null,e.msgList={}),setTimeout(function(){$.createEasemobConn(0),e.secondUserId&&$.createEasemobConn(1),$.$.loginUrl?$.page($.$.loginUrl,-1,!0):$.page("home",-1,!0)},a?500:1)}var o=$("#register-tel"),r=$("#register-authCode"),s=$("#register-authCode-btn"),t=$("#register-password"),l=$("#register-btn"),i=[0,0,0],n=!1,u=window.loginInfo,c=$("#content>div>div:nth-of-type(3)"),d=!1,g=$.localStorage("user-register-param")?JSON.parse($.localStorage("user-register-param")):null,p=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode;return $.$.payAuthCode=p,$.$.authCode=p,!$.$.ua.isWX||$.$.authCode&&"9358_login"==$.getUrlParam("state")?(u&&(o[0].value=u.username,u.password&&u.code&&(r[0].value=u.code,t[0].value=u.password),delete window.loginInfo,i[0]=!0,e()),o.Verify("tel",function(a){i[0]=a,e()}),r.Verify("authcode",function(a){i[1]=a,e()}),t.Verify("password",function(a){i[2]=a,e()}),s.Event("click",function(e,a){if(!s.ClassHave("disabled")&&!s.ClassHave("pause"))return i[0]?void $.ajax({url:"../api/v1/user/checkLoginName",isReplaceUrl:!0,type:"post",data:{loginName:o.Value()},success:function(e){if("1"==e.toString())return $.tipShow("该用户已经注册了！");s.Class("pause"),s.Text("重新发送(60s)");var a,r=60,t=setInterval(function(){0==--r?(clearInterval(t),a=s.Attr("data-repeat-count")-1,s.Attr("data-repeat-count",a),s.ClassClear("pause"),s.Text("获取验证码"),0==a&&s.Class("disabled")):s.Text("重新发送("+r+"s)")},1e3);$.ajax({url:"../api/v1/icode",isReplaceUrl:!0,type:"get",data:{mobile:o.Value()}})}}):$.tipShow("请输入正确的手机号码！")}),l.Click(function(){l.ClassHave("active")&&!n&&(n=!0,$.ajax({url:"../api/v1/user/checkLoginName",isReplaceUrl:!0,type:"post",data:{loginName:o.Value()},success:function(e){if("1"!=e.toString()){var s={mobile:o.Value(),code:r.Value(),password:t.Value(),clubId:$.$.clubID,chanel:$.$.sessionType,openId:$.$.openId||"",wxNickName:$.$.nickName||"",wxHeadimgurl:$.$.headerImgUrl,clubCode:$.$.clubInviteCode,techInviteCode:$.$.techInviteCode||"",auth2code:p,isBindWeixin:d?"Y":"N"};$.ajax({url:"../api/v1/user/register",isReplaceUrl:!0,type:"post",data:s,success:function(e){if(200==e.status){$.$.userToken=e.token,$.$.userID=e.userId,$.$.userHeader=e.avatarUrl||$.$.defaultHeader,$.$.userTel=e.phoneNum,$.$.userName=e.name,$.$.userLoginName=e.loginName,$.cookie("userToken",$.$.userToken,30),$.cookie("userID",$.$.userID,30),$.cookie("userHeader",$.$.userHeader,30),$.cookie("userTel",$.$.userTel,30),$.cookie("userName",$.$.userName,30),$.cookie("userLoginName",$.$.userLoginName,30),$.localStorage("userToken",$.$.userToken),$.localStorage("userID",$.$.userID),$.localStorage("userHeader",$.$.userHeader),$.localStorage("userTel",$.$.userTel),$.localStorage("userName",$.$.userName),$.localStorage("userLoginName",$.$.userLoginName),$.tipShow("注册成功！");var o=$.$.easemob;o.userId=e.emchatId,$.localStorage("easemobUserId",o.userId),g.oldUserId&&g.oldUserId!=$.$.userID&&($.localStorage("easemobSecondUserId",g.oldChatId),o.secondUserId=g.oldChatId,$.switchUserChatInfo(g.oldUserId,$.$.userID)),a()}else"935801"==e.statusCode&&($.localStorage("user-register-param",JSON.stringify(s)),$.getOauthCode("","9358","9358_login","base"));n=!1},error:function(e){"系统异常,请稍后重试"==e&&$.tipShow("验证码不正确！"),n=!1}})}else $.tipShow("该用户已注册！"),n=!1}}))}),g&&g.username&&(o[0].value=g.username,i[0]=!0,d=g.isBindWeixin,g.password?(t[0].value=g.password,i[2]=!0,r[0].value=g.code,i[1]=!0,e(),$.localStorageClear("user-register-param"),l[0].click()):e()),$("#register-login-link").Page(),void $.pageSwitch(!0,!1)):void $.getOauthCode("","9358","9358_login","base")}();