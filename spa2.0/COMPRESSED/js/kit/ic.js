!function(t,e){function n(t){function e(t){var e,o,l=t.dom,g=0;l.style.display="none;",l.style.width=y+"px",l.style.height=T+"px",l.style.position="relative",l.innerHTML='<canvas width="'+y+'" height="'+T+'" style="width:'+y+"px;height:"+T+'px;background: #000;"></canvas>                <canvas style="display: none;position: absolute;top:'+k+"px;left:"+I+"px;width:"+x+"px;height:"+b+'px;background:#000;"></canvas>                <div style="height:2.08rem;width:6.324rem;position: absolute;left:50%;margin-left:-3.167rem;top:'+(k+b+15)+'px;line-height:2.08rem;border-radius:1.1rem;font-size:0.9rem;color:#666;text-align:center;background-color:#ccc">翻转</div>',f=l.children[0],m=f.getContext("2d"),v=l.children[1],p=v.getContext("2d"),w=l.getElementsByTagName("div")[0],l.addEventListener("touchstart",function(t){t.target!=w&&(t.preventDefault(),e=[t.targetTouches[0].clientX,t.targetTouches[0].clientY],g=1,2==t.targetTouches.length&&(o=r(e[0]-t.targetTouches[1].clientX,e[1]-t.targetTouches[1].clientY),g=2))},!1),l.addEventListener("touchmove",function(t){if(t.target!=w){t.preventDefault();var a=[t.targetTouches[0].clientX,t.targetTouches[0].clientY];if(1==g&&1==t.targetTouches.length)c+=a[0]-e[0],s+=a[1]-e[1],e=a,h>x?c>I?c=I:c+h<R&&(c=R-h):c=(L-h)/2,u>b?s>k?s=k:s+u<C&&(s=C-u):s=(D-u)/2;else if(2==g&&2==t.targetTouches.length){var i=r(a[0]-t.targetTouches[1].clientX,a[1]-t.targetTouches[1].clientY),l=i/o,d=h*l,f=u*l;(d>x||f>b)&&(c-=(d-h)/h*(y/2-c),s-=(f-u)/u*(T/2-s),h=d,u=f,o=i)}n()}},!1),w.onclick=function(){a()},l.addEventListener("mousewheel",function(t){t.preventDefault(),t.wheelDelta>0?(h*=1.05,u*=1.05):t.wheelDelta<0&&(h/=1.05,u/=1.05),n()},!1),i()}function n(){var t=c+h/2,e=s+u/2;m.clearRect(0,0,y,T),m.save(),m.translate(t,e),m.rotate(90*B*Math.PI/180),m.translate(-t,-e),m.drawImage(l,c,s,h,u),m.restore(),i()}function a(){B=3==B?0:B+1,n()}function i(){m.fillStyle="rgba(0,0,0,0.7)",m.fillRect(0,0,y,k),m.fillRect(0,C,y,k),m.fillRect(0,k,I,b),m.fillRect(R,k,I,b),m.strokeStyle="rgba(225,255,225,1)",m.strokeRect(M,E,X,Y)}function r(t,e){return Math.sqrt(t*t+e*e)}function o(){h=g=l.width,u=d=l.height;var t=1/Math.min(h/x,u/b);h*=t,u*=t,c=(L-h)/2,s=(D-u)/2,n()}var l,c,s,h,u,g,d,f,v,m,p,w,y=t.width||300,T=t.height||300,x=t.widthCut||150,x=x<y?x:y,b=t.heightCut||150,b=b<T?b:T,I=(y-x)/2,k=(T-b)/2,R=I+x,C=k+b,D=k+C,L=I+R,M=I-1,E=k-1,X=x+2,Y=b+2,B=0;return e.prototype={putImageFromImg:function(t){return null!=t&&"object"==typeof t&&"img"==t.tagName.toLowerCase()&&(l=t,void o())},putImageUrl:function(t){return null!=t&&""!=t&&(l=new Image,l.onload=function(){o()},void(l.src=t))},getImageBase64:function(t,e){v.style.display="block";var n=t/x,a=e/b;v.width=t,v.height=e;var i=(c-I)*n,r=(s-k)*a,o=h*n,g=u*a,d=i+o/2,f=r+g/2;return p.save(),p.translate(d,f),p.rotate(90*B*Math.PI/180),p.translate(-d,-f),p.drawImage(l,i,r,o,g),p.restore(),p.canvas.toDataURL("image/png")}},new e(t)}t.imageCut=function(t){if(t=t||{},null!=t.dom)return n(t)}}(window);