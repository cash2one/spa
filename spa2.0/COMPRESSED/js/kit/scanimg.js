!function(t,i){function s(t,i){var s=t,h=i;return a.transform3d?"translate3d("+s+"px, "+h+"px, 0)":"translate("+s+"px, "+h+"px)"}function h(t,i){return a.touch?t.changedTouches[0][i]:t[i]}function e(){}var a={transform3d:"WebKitCSSMatrix"in t&&"m11"in new WebKitCSSMatrix,touch:"ontouchstart"in t};e.prototype={init:function(t){t=t||{},this.imgWrap=t.imgWrap,this.img=null,this.hideScanImgWrap=!1,this.buffMove=3,this.finger=!1,this.closeCallback=t.closeCallback,this._destroy();var i=this;this.imgWrap.addEventListener("click",function(){i.showImgTime&&(new Date).getTime()-i.showImgTime<500||"show"==i.imgWrap.className&&i.close()})},close:function(){this.imgWrap.className="hide",this.hideScanImgWrap=!0,this._destroy(),this.img.ontouchstart=null,this.img.ontouchmove=null,this.img.ontouchend=null,i.removeEventListener("touchmove",this.eventStop,!1),this.closeCallback&&this.closeCallback(this.img,this.loadImgStyle)},showImg:function(t){this.img=t,this.imgWrap.appendChild(this.img),this.loadImgStyle=this.img.style.cssText;var s=document.documentElement.clientWidth||window.innerWidth,h=this.img.getAttribute("w"),e=this.img.getAttribute("h"),a=s/h,o=e*a,n=this;this.img.style.height=o+"px",this.img.style.width=s+"px",this.img.style.marginTop="-"+o/2+"px",i.addEventListener("touchmove",n.eventStop,!1),this.imgBaseWidth=s,this.imgBaseHeight=o,this.addEventStart({wrapX:n.imgWrap.offsetWidth,wrapY:n.imgWrap.offsetHeight,mapX:s,mapY:o}),this.hideScanImgWrap=!1,this.lastTapTime=null,this.closeTimeOut=null,this.imgWrap.className="show",this.showImgTime=(new Date).getTime(),this.img.ontouchstart=function(t){n._touchStart(t)},this.img.ontouchmove=function(t){n._touchMove(t)},this.img.ontouchend=function(t){n._touchEnd(t)}},addEventStart:function(t){t=t||{},this.wrapX=t.wrapX||0,this.wrapY=t.wrapY||0,this.mapX=t.mapX||0,this.mapY=t.mapY||0,this.width=this.mapX-this.wrapX,this.height=this.mapY-this.wrapY},_destroy:function(){this.distX=0,this.distY=0,this.newX=0,this.newY=0},_changeData:function(){this.mapX=this.img.offsetWidth,this.mapY=this.img.offsetHeight,this.width=this.mapX-this.wrapX,this.height=this.mapY-this.wrapY},_touchStart:function(t){t.preventDefault();var i=t.targetTouches.length;this._changeData(),1==i?(this.basePageX=h(t,"pageX"),this.basePageY=h(t,"pageY"),this.finger=!1):(this.finger=!0,this.startFingerDist=this.getTouchDist(t).dist,this.startFingerX=this.getTouchDist(t).x,this.startFingerY=this.getTouchDist(t).y)},_touchMove:function(t){t.preventDefault(),t.stopPropagation();var i=t.targetTouches.length;1!=i||this.finger||this._move(t),i>=2&&this._zoom(t)},_touchEnd:function(t){var i=h(t,"pageX"),s=h(t,"pageY"),e=this;return this.basePageX&&this.basePageY&&i==this.basePageX&&s==this.basePageY?e.imgWrap.click():(this._changeData(),this.finger&&(this.distX=-this.imgNewX,this.distY=-this.imgNewY),this.distX>0?this.newX=0:this.distX<=0&&this.distX>=-this.width?(this.newX=this.distX,this.newY=this.distY):this.distX<-this.width&&(this.newX=-this.width),void this.reset())},_move:function(t){var i=h(t,"pageX"),s=h(t,"pageY");this.distX=i-this.basePageX+this.newX,this.distY=s-this.basePageY+this.newY,this.distX>0?this.moveX=Math.round(this.distX/this.buffMove):this.distX<=0&&this.distX>=-this.width?this.moveX=this.distX:this.distX<-this.width&&(this.moveX=-this.width+Math.round((this.distX+this.width)/this.buffMove)),this.movePos(),this.finger=!1},_zoom:function(t){var i=this.getTouchDist(t).dist,s=i/this.startFingerDist;this.zoomImg(s),this.finger=!0},zoomImg:function(t){},movePos:function(){if(this.height<0)if(this.img.offsetWidth==this.imgBaseWidth)this.moveY=Math.round(this.distY/this.buffMove);else{var t=Math.round((this.img.offsetHeight-this.imgBaseHeight)/2);this.moveY=-t+Math.round((this.distY+t)/this.buffMove)}else{var i=Math.round((this.wrapY-this.imgBaseHeight)/2),s=this.img.offsetHeight-this.wrapY+Math.round(this.wrapY-this.imgBaseHeight)/2;this.distY>=-i?this.moveY=Math.round((this.distY+i)/this.buffMove)-i:this.distY<=-s?this.moveY=Math.round((this.distY+s)/this.buffMove)-s:this.moveY=this.distY}this.refresh(this.moveX,this.moveY,"0s","ease")},reset:function(){var t=".2s";if(this.height<0)this.newY=-Math.round(this.img.offsetHeight-this.imgBaseHeight)/2;else{var i=Math.round((this.wrapY-this.imgBaseHeight)/2),s=this.img.offsetHeight-this.wrapY+Math.round(this.wrapY-this.imgBaseHeight)/2;this.distY>=-i?this.newY=-i:this.distY<=-s?this.newY=-s:this.newY=this.distY}this.refresh(this.newX,this.newY,t,"ease-in-out")},refresh:function(t,i,h,e){this.img.style.webkitTransitionProperty="-webkit-transform",this.img.style.webkitTransitionDuration=h,this.img.style.webkitTransitionTimingFunction=e,this.img.style.webkitTransform=s(t,i)},getTouchDist:function(t){var s=t.touches[0].pageX,h=t.touches[0].pageY-i.body.scrollTop,e=t.touches[1].pageX,a=t.touches[1].pageY-i.body.scrollTop,o=0,n=0;if(s&&e)return o=s<=e?(e-s)/2+s:(s-e)/2+e,n=h<=a?(a-h)/2+h:(h-a)/2+a,{dist:Math.round(Math.sqrt(Math.pow(s-e,2)+Math.pow(h-a,2))),x:Math.round(o),y:Math.round(n)}},eventStop:function(t){t.preventDefault(),t.stopPropagation()}},t.ImgScan=e}(window,document);