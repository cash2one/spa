!function(){function e(){s.Click(function(){if(!s.ClassHave("disabled")){if(s.ClassHave("processing"))return $.tipShow("正在处理中，请稍候...");s.Class("processing"),s.Text("支付...");var e={businessChannel:"link",accountId:a,amount:t.Value(),clubId:i||"",tradeChannel:"wx"};$.ajax({url:"../api/v2/wx/pay/recharge/save",isReplaceUrl:!0,type:"post",data:e,success:function(t){function n(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp+"",nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){s.ClassClear("processing"),s.Text("确认支付"),e.err_msg.indexOf("ok")>=0?($.tipShow("支付成功！"),$.page("accountDetail&accountId="+a)):$.tipShow("未能成功支付！")})}200==t.statusCode?(t=JSON.parse(t.respData),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n)):n()):"935801"==t.statusCode?($.localStorage("con-recharge-param",JSON.stringify(e)),$.getOauthCode("","9358","confirm-recharge","base")):(s.ClassClear("processing"),s.Text("确认支付"),$.tipShow(t.msg||"充值失败！"))},error:function(){s.ClassClear("processing"),s.Text("确认支付"),$.tipShow("error")}})}}),l&&($.localStorageClear("con-recharge-param"),t[0].value=l.amount,s.ClassClear("disabled"),s[0].click()),t.Event("focus",function(){n.Class("hide")}),t.Event("blur",function(){""==t.Value()&&n.ClassClear("hide")}),t.Event("input",function(){if(""==t[0].value)r.length>1?(t[0].value=r,s.ClassClear("disabled")):(r="",s.Class("disabled"));else{var e=t[0].value.match(/\./g);e&&t[0].value.match(/\./g).length>1&&(t[0].value=t[0].value.substring(0,t[0].value.length-1)),/^([1-9][0-9]*)$/g.test(t[0].value)?0!=t[0].value?(r=t[0].value,s.ClassClear("disabled")):s.Class("disabled"):(t[0].value=r,""!=r&&s.ClassClear("disabled"))}}),$.pageSwitch()}var a=$.param("accountId")||$.getUrlParam("accountId")||"",t=$("#moneyInput"),n=$("#inputPlaceholder"),s=$("#sureBtn"),r="",c=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,i=$.param("clubId")||$.$.clubID,l=$.localStorage("con-recharge-param")?JSON.parse($.localStorage("con-recharge-param")):null;return $.$.ua.isWX?void(l&&c?$.ajax({url:($.$.clubID?"../":"")+"../wx/oauth2/user/openid",type:"post",data:{code:c,scope:"snsapi_base",wxmp:"9358",userType:"user",state:"confirm-recharge"},success:function(a){if(200==a.statusCode)e();else{if("935801"!=a.statusCode)return $.tipShow(a.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","confirm-recharge","base")}}}):e()):void($.checkAccessMenu("recharge")&&($.tipShow("请在微信中打开"),$.pageCancel()))}();