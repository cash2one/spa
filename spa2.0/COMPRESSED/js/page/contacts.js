!function(){function e(e,t){r||(r=!0,p=e||p+1,g.ClassClear("none"),h.Class("none"),u=!1,$.ajax({url:"../api/v1/emchat/friendlist/"+$.$.easemob.userId,isReplaceUrl:!0,data:{channel:"center",page:p,pageSize:S},success:function(e){if("200"!=e.statusCode)return $.tipShow(e.msg||"数据请求失败！");e=e.respData,d="";var a,o,l,f;for(n=0,i=e.length;n<i;n++)(!$.$.clubID||e[n].clubId&&e[n].clubId==$.$.clubID)&&(a=new Date,o=e[n].chatDate.split(" "),l=o[1].split(":"),o=o[0].split("-"),a.setFullYear(o[0]-0,o[1]-1,o[2]-0),a.setHours(l[0]-0,l[1]-0,l[2]-0),c=T[e[n].friendChatId],f=e[n].friendDescription||"",c&&(f=s(c.msg.data.replace(/<br>|<br\/>/g,"")),a=c.time),d+="<div data-chat-Id='"+e[n].friendChatId+"' data-target-Id='"+e[n].friendUserId+"'  data-club-Id='"+(e[n].clubId||"")+"'  data-friend-Name='"+(e[n].friendName||"")+"' data-to-type='"+e[n].toType+"' data-header='"+e[n].friendAvatarUrl+"'>                                <div style='background-image: url("+(e[n].friendAvatarUrl||("manager"==e[n].toType?$.$.defaultClubLogo:$.$.defaultHeader))+")'></div>                                <div>                                    <div>"+e[n].friendName+(e[n].techNo&&e[n].techNo.length>0?"<span><span>[</span>"+e[n].techNo+"<span>]</span></span>":"")+"</div>                                    <div>"+f+"</div>                                    <div>"+$.formatMsgTime(a)+"</div>                                </div><div class='delete-msg'>删除记录</div>                         </div>");1==p?(v.Html(d),d?y.style.display="none":(y.style.display="block",u=!0),b=v[0].scrollHeight):(v.Html(d,!0),i<S&&(u=!0,h.ClassClear("none"))),r=!1,g.Class("none"),t&&t()}}))}function t(e){$.sessionStorage("contacts_data",v.Html()),$.sessionStorage("contacts_page",p),$.sessionStorage("contacts_page_height",b),$.sessionStorage("contacts_end",u),$.sessionStorage("contacts_top",f[0].scrollTop);var t=e.parentNode.dataset,a=t.chatId,s=t.targetId,n=t.clubId,i=t.toType;if("tech"==i)$.page("chat&techId="+s+"&clubId="+n);else if("manager"==i){var o=$.getSessionList(!1,!0)[a]||{name:e.parentNode.getAttribute("data-friend-name"),header:t.header||$.$.defaultClubLogo,avatar:"",clubId:n};$.$.easemob.currChatTech={chatId:a,name:o.name,header:o.header,avatar:o.avatar,clubId:o.clubId,clubName:"",techId:"",inviteCode:"",no:"",appointment:"n",phoneAppointment:"n",telephone:"",chatName:"",chatHeader:""},$.page("chat&techId="+(o.techId||"")+($.$.clubID?"":"&clubId="+o.clubId))}}function a(){f.Event("scroll",function(t){!u&&f[0].scrollTop+f[0].clientHeight-(p+_-1)*b>=0&&e()}),$("#content").Delegate("click",">div.list>div>div:nth-of-type(1),>div.list>div>div:nth-of-type(2)",function(e,a){t(a)}),l.Event("click",function(e,t){var a=$(t);a.ClassHave("edit-title")?($(".delete-msg").Class("active"),a.ClassClear("edit-title"),a.Class("complete-title"),a.Text("完成")):(a.ClassClear("complete-title"),a.Class("edit-title"),$(".delete-msg").ClassClear("active"),a.Text("编辑"))}),$("#content").Delegate("click",">div.list .delete-msg",function(e,t,a){e.preventDefault();var s=$(t.parentNode),n=s.Attr("data-chat-id"),i=$("#content>div.list")[0];$.ajax({url:"../api/v1/emchat/friend",isReplaceUrl:!0,type:"post",data:{channel:"center",currentChatId:$.$.easemob.userId,showFlag:"n",friendChatId:n},success:function(e){return"200"!=e.statusCode?$.tipShow(e.msg||"请求失败！"):(i.removeChild(s[0]),void(0==$(i).Children().length&&(y.style.display="block",l[0].click())))}})}),$("#title>div:nth-of-type(2)>a").Click(function(e,t){$.page("",-1)})}function s(e){return e.replace(o,function(){return D[arguments[0]]||arguments[0]})}var n,i,o,c,l=$("#title>div:nth-of-type(1)>div"),d="",r=!1,p=1,g=$("#loadTip"),h=$("#finishTip"),u="true"==($.sessionStorage("contacts_end")||"false"),v=$("#content>div.list"),f=$("#content"),m=$.sessionStorage("contacts_top"),C=$.sessionStorage("contacts_page"),I=$.sessionStorage("contacts_data"),b=$.sessionStorage("contacts_page_height")||0,S=10,_=.4,y=$("#content>div.nullData")[0],T=$.getSessionList(!1,!0),D={"/::O":"/大笑","/::Y":"/坏笑","/::B":"/害羞","/::A":"/色","/::C":"/晕","/::D":"/红心","/::X":"/心碎了","/::Z":"/握手","/::F":"/抱拳","/::E":"/花","/::T":"/花谢了","/::P":"/示爱","/::G":"/亲亲","/::H":"/大哭","/::I":"/可怜","/::J":"/生气","/::K":"/微笑","/::L":"/冷汗","/::M":"/困","/::N":"/调皮","/::Q":"/敲打","/::R":"/疑问","/::S":"/猪头","/::U":"/汽水","/::V":"/西瓜","/::W":"/鼓掌","/::a":"/大拇指","/::b":"/剪刀手"};o=new RegExp("/::[A-Zab]+","g"),$.pageSwitch(!0,!0),I?(p=parseInt(C),v.Html(I),setTimeout(function(){f[0].scrollTop=m},1),a(),u&&h.ClassClear("none"),$.pageSwitch()):(e(1),a()),$.sessionStorageClear("contacts_data"),$.sessionStorageClear("contacts_end"),$.sessionStorageClear("contacts_top"),$.sessionStorageClear("contacts_page"),$.sessionStorageClear("contacts_page_height")}();