!function(){var e,t,n=$.param("orderId")||$.param("id"),i=$.param("techId"),a=$.param("type"),o=$.param("commentId")||"",c="1"==$.getUrlParam("isScan",!0);$.$.payAuthCode=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,$.paramClear("commentId"),$.$.ua.isWX&&($("#content>div>div:nth-of-type(5)>div:nth-of-type(3)").CSS("display","none"),$("#content>div>div:nth-of-type(5)>div:nth-of-type(4)").CSS("display","none"),$("#content>div>div:nth-of-type(5)>div:nth-of-type(1)").CSS("display","block"),$("#content>div>div:nth-of-type(5)").CSS("padding-top","1.25rem")),c&&$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(5),.service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(6)").ClassClear("hide"),$.ajax({url:($.$.clubID?"../":"")+"/impression/list",data:{},success:function(d){200!=d.statusCode&&$.tipShow(d.msg||"查询印象标签数据出错");var v=[],l={};d.respData.forEach(function(e,t){v.push("<div>"+e.tag+"</div>"),l[e.tag]=t}),$(".comment-labels").Html(v.join("")),$.ajax({url:($.$.clubID?"../":"")+"/shared/technician",data:{id:n||i,type:a,commentId:o},success:function(d){function v(e,t){var n=Math.ceil(e.offsetX/t.clientWidth/.2),i=t.dataset.index,a=$(t).Children();(!n||n<1)&&(n=1),p[i]=20*n,a[0].style.width=p[i]+"%",h[i].Text(f[3==i?1:0][n-1])}function s(e){var t=0;m.every(function(n,i){return n.Text()!=e||(t=i,!1)}),m.splice(t,1)}function r(e,t){var n=$(t);n.ClassHave("active")?(n.ClassClear("active"),s(n.Text())):(n.Class("active"),m.length>0&&3==m.length&&m.shift().ClassClear("active"),m.push(n))}if(200!=d.statusCode)return $.tipShow(d.msg||"数据获取失败！"),$.pageCancel();d=d.respData,e=d.tech;var p=[100,100,100,100],f=[["非常差","很差","一般","很好","非常好"],["非常严重","很严重","一般","无偷钟","认真负责"]],h=[$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(3)"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(3)"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(3)>div:nth-of-type(3)"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(4)>div:nth-of-type(3)"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(5)>div:nth-of-type(3)"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(6)>div:nth-of-type(3)")],m=[],y=$("div.comment-text>textarea"),u=$("div.comment-text>span"),C=d.allow,_=$("#commentFooter>div>div:nth-of-type(2)"),b=$("#commentFooter>div>div:nth-of-type(1)"),x=!1;if($(".service-level>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").CSS("backgroundImage",'url("'+(d.tech.avatarUrl||$.$.defaultHeader)+'")'),$(".service-level>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)").Text(d.tech.name||$.$.defaultTechName),d.tech.serialNo?$(".service-level>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Text(d.tech.serialNo):$(".service-level>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Hide(),$("#commentFooter>div>div:nth-of-type(2)").Class("active"),t=d.tech.clubId,i=d.tech.id,"9358"==$.$.visitChannel?$("#content>div>div:nth-of-type(5)").CSS("display","none"):$.ajax({url:"../api/v1/wx/club/param_qrcode",isReplaceUrl:!0,data:{clubId:t},success:function(e){"200"==e.statusCode&&("N"==e.respData?$.ajax({url:"../api/v1/wx/club/param_qrcode",isReplaceUrl:!0,data:{clubId:t},success:function(e){"200"==e.statusCode&&"N"!=e.respData&&($("#content>div>div:nth-of-type(5)>div:nth-of-type(2)>img")[0].src=e.respData)}}):$("#content>div>div:nth-of-type(5)>div:nth-of-type(2)>img")[0].src=e.respData)}}),$(".service-level>div:nth-of-type(1)>div:nth-of-type(2)").Page("technicianDetail&id="+d.tech.id),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div").Delegate("click",">div:nth-of-type(2)",v,!1,"__star_click_event__"),$(".comment-labels").Delegate("click",">div",r,!1,"__labels_click_event__"),y.Event("focus",function(e){u.Class("none"),$("#content")[0].scrollTop=20.444*$.$.scale*16}),y.Event("blur",function(e){0==y.Value().length&&u.ClassClear("none")}),0==C)$("#content>div>div:nth-of-type(2)").Class("none");else if(1==C){$("#content>div>div:nth-of-type(2)").ClassClear("none"),$("#content>div>div:nth-of-type(5)").CSS("display","none"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div>div:nth-of-type(2)").EventRemove("click",v,!1,"__star_click_event__"),$(".comment-labels").EventRemove("click",r,!1,"__labels_click_event__"),y.Value(d.comment.comment+" "),y.Attr("readonly","readonly"),u.Hide(),$("div.comment-text>div").Hide(),$("#commentFooter").Hide();var g=$(".comment-stars>div").Children();p=[d.comment.attitudeRate,d.comment.appearanceRate,d.comment.skillRate,d.comment.clockRate],p.forEach(function(e,t){e<20&&(e=20),p[t]=e,g[t].style.width=e+"%",h[t].Text(f[t<3?0:1][Math.ceil(e/20)-1])});var k=d.comment.impression.split("、"),S=$(".comment-labels>div");k.forEach(function(e,t){S.Index(l[e]).Class("active")}),y.Event("focus",function(e,t){t.blur()}),d.comment.comment||$(".comment-text").Hide()}b.Click(function(e,t){b.ClassHave("checked")?b.ClassClear("checked"):b.Class("checked")}),_.Click(function(){if(_.ClassHave("active"))if(x)$.tipShow("正在提交评论，请稍候...");else if(0==C){x=!0,_.Class("disabled"),_.Text("提交中...");var t=y.Value();t&&t.length>200&&(t=t.substr(0,200)),$.ajax({url:($.$.clubID?"../":"")+"/user/comment/create",data:{id:n||i,type:c?"tech_qrcode":a,attitudeRate:p[0],appearanceRate:p[1],skillRate:p[2],clockRate:p[3],impression:function(){var e=[];return m.forEach(function(t){e.push(t.Text())}),e.join("、")}(),comment:encodeURIComponent(t),isAnonymous:b.ClassHave("checked")?"Y":"N"},type:"post",success:function(t){"200"==t.statusCode?(x=!1,C=1,_.ClassClear("disabled"),_.Text("提交"),$("#content>div>div:nth-of-type(2)").ClassClear("none"),$("#content>div>div:nth-of-type(5)").CSS("display","none"),$(".service-level>div:nth-of-type(2)>div:nth-of-type(2)>div").EventRemove("click",v,!1,"__star_click_event__"),$(".comment-labels").EventRemove("click",r,!1,"__labels_click_event__"),""==y.Value()&&(y.Value(" "),$(".comment-text").Hide()),y.Attr("readonly","readonly"),u.Hide(),$("div.comment-text>div").Hide(),$("#commentFooter").Hide(),y.Event("focus",function(e,t){t.blur()}),$("#content")[0].scrollTop=0,$.$.ua.isWX&&(o=t.respData,$.param("commentId",o),$.page("techReward&isAnonymous="+(b.ClassHave("checked")?"Y":"N")+"&techId="+i+(o?"&commentId="+o:"")))):"412"==t.statusCode?($.tipShow(t.msg||"您今天已经评论过该技师了"),"fastPay"==$.param("from")?setTimeout(function(){$.$.afterReward=!0,$.$.afterRewardInfo||($.$.afterRewardInfo={}),$.$.afterRewardInfo.avatarUrl=e.avatarUrl,$.$.afterRewardInfo.name=e.name,$.$.afterRewardInfo.clubName="",$.page("home")},500):$.page()):(x=!1,_.ClassClear("disabled"),_.Text("提交"),$.tipShow(t.msg||"评论出错"))},error:function(){x=!1,_.ClassClear("disabled"),_.Text("提交")}})}else $.tipShow("此评论已提交。")}),$.pageSwitch(!0,!1)}})}})}();