!function(e){function t(e,t){function i(e){var i="";switch(e.code){case e.PERMISSION_DENIED:i="用户拒绝对获取地理位置的请求。";break;case e.POSITION_UNAVAILABLE:i="位置信息是不可用的。";break;case e.TIMEOUT:i="请求用户地理位置超时。";break;case e.UNKNOWN_ERROR:i="未知错误。"}"function"==typeof t&&t(i,e.code)}navigator.geolocation?navigator.geolocation.getCurrentPosition(e,i):"function"==typeof t&&t("该浏览器不支持定位。")}function i(e){return e*d/180}function a(e,t,a,d){var o=i(e),c=i(a),v=o-c,s=i(t)-i(d),l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(v/2),2)+Math.cos(o)*Math.cos(c)*Math.pow(Math.sin(s/2),2)));return l*=n,l=Math.round(1e4*l)/1e4}var n=6378137,d=Math.PI;e.spaHomeUtil={getLocation:t,getGreatCircleDistance:a}}(window),function(){$.ajax({url:"homeData",success:function(e){function t(){if($.$.currLngx&&$.$.currLaty&&e.club.longitude&&e.club.latitude){var t=~~spaHomeUtil.getGreatCircleDistance($.$.currLaty,$.$.currLngx,e.club.latitude,e.club.longitude);t/1e3>1?t=(t/1e3).toFixed(1)+" km":t+=" m",$(".banner>div:nth-of-type(4)>div:nth-of-type(1)").Text(t)}else $(".banner>div:nth-of-type(4)>div:nth-of-type(1)").Text("定位失败")}if("200"!=e.statusCode)return $.tipShow(e.msg||"获取会所数据失败！");e=e.respData;var i,a,n,d,o="",c="",v=e.sliderPic.length,s=$("#telDetail"),l=$("#content")[0],r=$(".banner>div:nth-of-type(1)>div:nth-of-type(1)"),u=$(".banner>div:nth-of-type(1)>div:nth-of-type(2)"),p=$(".banner>div:nth-of-type(2)>div:nth-of-type(1)");for(e.club.telephone||(e.club.telephone=""),0==v&&(e.sliderPic=[{imageUrl:$.$.defaultBanner}],v=1),i=0;i<v;i++)o+='<img src="'+(e.sliderPic[i].imageUrl||$.$.defaultBanner)+'" link="'+(e.sliderPic[i].link||"")+'"/>',c+="<span></span>";for(r.Html(o),u.Html(c),$.$.clubLogo=e.club.imageUrl||$.$.defaultClubLogo,p.CSS("backgroundImage",'url("'+$.$.clubLogo+'")'),$.$.clubName=e.club.name||$.$.defaultClubName,$(".banner>div:nth-of-type(2)>div:nth-of-type(2)").Text($.$.clubName),$.$.currLngx&&$.$.currLaty?t():spaHomeUtil.getLocation(function(e){$.$.currLngx=e.coords.longitude,$.$.currLaty=e.coords.latitude,t()},function(e,i){t()}),e.isUserFavoriteClub&&($(".banner>div:nth-of-type(3)").Class("collected"),$(".banner>div:nth-of-type(3)>div:nth-of-type(2)").Text("已收藏")),o="",i=0,v=e.serviceItems.length;i<v;i++)o+=e.serviceItems[i].discountPrice?'<div hh="'+e.serviceItems[i].id+'">                     <div '+(0==i?'class="recommend-label"':"")+" style=\"background-image: url('"+(e.serviceItems[i].imageUrl||$.$.defaultService)+"')\"><div>"+e.serviceItems[i].name+'</div></div>                        <div class="has-discount">                            <div >网店价<span>￥</span>'+e.serviceItems[i].discountPrice+"</div>                            <div ><span>￥</span>"+e.serviceItems[i].price1+"</div>                        </div>                    </div>":'<div hh="'+e.serviceItems[i].id+'">                     <div '+(0==i?'class="recommend-label"':"")+" style=\"background-image: url('"+(e.serviceItems[i].imageUrl||$.$.defaultService)+"')\"><div>"+e.serviceItems[i].name+"</div></div>                        <div>                            <div"+(e.serviceItems[i].price1?"":' style="visibility:hidden;"')+"><span>￥</span>"+e.serviceItems[i].price1+"</div>                            <div"+(e.serviceItems[i].price1?"":' style="visibility:hidden;"')+">"+e.serviceItems[i].duration1+"<span>"+(e.serviceItems[i].durationUnit||"分钟")+"</span></div>                        </div>                    </div>";if($(".service>div:nth-of-type(2)").Html(o),0==v&&$(".service").Hide(),o="",""!=e.club.telephone)for(i=0,c=e.club.telephone.split(","),v=c.length;i<v;i++)o+="<div>"+c[i]+"</div>";if($("#telDetail>div").Html(o+"<div>取消</div>"),a=$.scroll({content:$(".banner>div:nth-of-type(1)")[0],contentX:r[0],flagX:u[0],loopX:!0,autoX:!0}),$(".banner>div:nth-of-type(1)>div:nth-of-type(1)>img").Event("click",function(e,t){var i=$(t).Attr("link");i&&(top.location.href=i)}),e.journal&&e.journal.id&&($(".journal").CSS("display","block"),$(".journal>div>span").Text(e.journal.title).Click(function(){location.href=location.origin+"/spa-manager/journal/#/"+(e.journal.templateId||1)+"/?id="+e.journal.id}),$(".journal>div>div").Page("journalList")),$(".banner>div:nth-of-type(2)").Page("clubProfile"),$("#paidCoupon").Page("activities"),$(".banner>div:nth-of-type(4)>div:nth-of-type(1)").Page("map"),$(".banner>div:nth-of-type(4)>div:nth-of-type(2)").Click(""==e.club.telephone?function(){$.tipShow("暂无电话")}:function(){s.Class("active"),$.hideOrderMenu()}),$(".banner>div:nth-of-type(3)").Click(function(e,t){var i,a,n=$(t);return $.$.userToken?(n.ClassHave("collected")?(a=!0,i="../api/v2/profile/user/favorite/club/delete"):(a=!1,i="../api/v2/profile/user/favorite/club/save"),void $.ajax({url:i,isReplaceUrl:!0,data:{clubId:$.$.clubID},success:function(e){200==e.statusCode?a?(n.ClassClear("collected"),$(".banner>div:nth-of-type(3)>div:nth-of-type(2)").Text("收藏")):(n.Class("collected"),$(".banner>div:nth-of-type(3)>div:nth-of-type(2)").Text("已收藏")):$.tipShow(e.msg||"操作失败")}})):($.$.loginUrl="home",void $.page("login"))}),s.Event("touchmove",function(e){e.preventDefault()},!1),s.Click(function(e,t){e.target==t&&(s.ClassClear("active"),$.showOrderMenu())}),n=$("#telDetail>div>div"),d=n.Remove(n.length-1),n.Click(function(e,t){location.href="tel:"+t.innerHTML}),d.Click(function(){s.ClassClear("active"),$.showOrderMenu()}),e.techs.length>0){for(o="",i=0;i<e.techs.length;i++)o+="<div hh='"+e.techs[i].techId+"'>                            <div style=\"background-image: url('"+(e.techs[i].avatarUrl||$.$.defaultHeader)+"')\">                                <div>"+e.techs[i].techName+"</div><div "+(i>0?'style="display:none;"':"")+"></div>                            </div>                            <div><div><div></div><div>"+(e.techs[i].visitCount>=1e3?(e.techs[i].visitCount/1e3).toFixed(1)+"K":e.techs[i].visitCount)+"</div></div><div><div></div><div>"+(e.techs[i].goodCommentCount>=1e3?(e.techs[i].goodCommentCount/1e3).toFixed(1)+"K":e.techs[i].goodCommentCount)+"</div></div></div>                        </div>";$(".tech>div:nth-of-type(2)>div").Html(o),scrollHori({container:$(".tech>div:nth-of-type(2)>div")[0],showEleCount:4})}else $(".tech").CSS("display","none");$(".tech>div:nth-of-type(1)").Click(function(){$.page("technicianList")}),$(".tech>div:nth-of-type(2)").Delegate("click",">div>div",function(e,t){$.page("technicianDetail&id="+t.getAttribute("hh"))}),$(".service>div:nth-of-type(1)").Click(function(){$.page("serviceList")}),$(".service>div:nth-of-type(2)>div").Click(function(e,t){$.sessionStorage("home_top",l.scrollTop,3e4),$.page("serviceItem&id="+t.getAttribute("hh")+"&top=1")}),l.scrollTop=$.sessionStorage("home_top"),$.sessionStorageClear("home_top"),$("#orderBtn").Page("technicianList");var f=$("#coupons"),h=$(".activity-pop"),m=$("#timeLimit"),y=$("#oneYuan"),g=$("#luckyWheel"),C=$("#journal");$(".activity-pop>div>div:nth-of-type(2)").Click(function(){h.ClassClear("active")}),h.Event("touchmove",function(e,t){e.preventDefault()}),$.ajax({url:"../api/v2/club/popup/get",isReplaceUrl:!0,data:{clubId:$.$.clubID},success:function(e){function t(){location.href=location.origin+"/spa-manager/coupons/#home&actId="+e.activityId+"&chanel=index"}if(200==e.statusCode){if(e=e.respData,!e)return;var i=$.localStorage("pastPopInfo_"+$.$.clubID)?JSON.parse($.localStorage("pastPopInfo_"+$.$.clubID)):{};if(i.id!=e.id||i.id&&i.time&&new Date-new Date(i.time)>864e5)switch($.localStorage("pastPopInfo_"+$.$.clubID,JSON.stringify({id:e.id,time:(new Date).getTime()})),e.activityType){case"coupon":e.activityName=e.activityName.substring(e.activityName.indexOf("】"));var a=function(e){for(var t,i=0,a=0;a<e.length;a++)t=e.charAt(a),i+=null!=t.match(/[^\x00-\xff]/gi)?2:1;return i}(e.activityName),n=$("#coupons>div:nth-of-type(1)>div"),d=$("#coupons>div:nth-of-type(1)>div>div");d.Html(e.activityName),a<=10||(a<=12?n.Class("spec-6"):a<=14?n.Class("spec-7"):a<=16?n.Class("spec-8"):(n.Class("two-line"),a>32&&d.Html(e.activityName.substr(0,14)+"..."))),$("#coupons>div:nth-of-type(1),#coupons>div:nth-of-type(2)").Click(t),f.Event("touchmove",function(e){e.preventDefault()},!1),$("#coupons>div:nth-of-type(3)").Click(function(){f.Hide()}),f.Show();break;case"paid_service_item":m.Class("active"),$("#timeLimit>div>div:nth-of-type(1)>div").Click(function(t,i){$.page("robProjectDetail&robProjectId="+e.activityId)});break;case"one_yuan":case"paid_plumflowe":y.Class("active"),$("#oneYuan>div>div:nth-of-type(1)>div").Click(function(t,i){"one_yuan"==e.activityType?$.page("oneYuanDetail&oneYuanBaseId="+e.activityId):$.page("plumflowers&id="+e.activityId)});break;case"luckyWheel":g.Class("active"),$("#luckyWheel>div>div:nth-of-type(1)>div").Click(function(t,i){location.href=location.origin+"/spa-manager/luckyWheel/?actId="+e.activityId+"&clubId="+e.clubId});break;case"journal":C.Class("active"),$("#journal>div>div:nth-of-type(1)>div").Click(function(t,i){location.href=location.origin+"/spa-manager/journal?id="+e.activityId})}}}});var b=[];$.ajax({url:"../api/v2/club/paid_service_item/list",isReplaceUrl:!0,data:{clubId:$.$.clubID},success:function(e){if(200==e.statusCode){e=e.respData||[];var t=[];if(e.length<=0)return;e.forEach(function(e,i){var a=+new Date;"paid_item"==e.actType?(b[i]=e.canPaidCount>0&&e.canPaidCount-e.paidCount==0||new Date-new Date(e.endDate.replace(/-/g,"/")).getTime()>=0||e,t.push('<div class="act-detail act-paid_item '+(b[i]===!0?"act-end":"")+'" data-act-id="'+e.id+'" data-act-index="'+i+'">                                    <div>                                        <div style="background-image: url('+(e.imageUrl||$.$.defaultService)+')"></div>                                        <div>                                            <div>                                                <div><div>'+e.name+"</div><div "+(e.usePeriod&&(7!=e.usePeriod.match(/(\d)/g).length||e.endTime)?"":'class="hide"')+">限时用</div></div>                                                "+(b[i]===!0?'<div style="display:none;"></div>':"<div>"+(e.canPaidCount>0?"剩余<span>"+(e.canPaidCount-e.paidCount)+"</span>份":"<span>不限份数</span>")+"</div>")+"                                            </div>                                            <div>                                                <div>                                                    <span>"+e.amount+"</span><span>元</span><span "+(e.credits>0?"":'style="display:none;"')+">（或<span>"+e.credits+"</span><span>积分</span>）</span>                                                </div>                                                <div>                                                    <div>                                                        <div>"+(b[i]===!0?"抢光了":"马上抢")+"</div>                                                        <div></div>                                                    </div>                                                </div>                                            </div>                                            <div>                                                <div>原价："+e.price+'元</div>                                                <div class="count-down">                                                    <div>距开始：</div>                                                    <div>12</div>                                                    <div>天</div>                                                    <div>23</div>                                                    <div>时</div>                                                    <div>59</div>                                                    <div>分</div>                                                </div>                                            </div>                                            <div>活动已结束，欢迎下次抢购！</div>                                        </div>                                    </div>                                </div>')):"one_yuan"==e.actType&&("end"==e.status?b.push(e):b.push(!1),t.push('<div class="act-detail act-one_yuan '+("online"==e.status&&a-new Date(e.startDate.replace(/-/g,"/"))>0?"act-started":"complete"==e.status?"act-complete":"")+'" data-item-id="'+e.id+'" data-act-index="'+i+'">                                        <div>                                            <div style="background-image:url('+(e.imageUrl||$.$.defaultService)+')"></div>                                            <div>                                                <div>                                                    <div>'+e.name+"<span>(第"+e.currentPeriod+"期)</span></div>                                                    "+function(){return"online"==e.status&&a-new Date(e.startDate.replace(/-/g,"/"))>0?"<div>剩余<span>"+e.canPaidCount+"</span>份</div>":"end"==e.status?"<div>待开奖</div>":"<div>未开始</div>"}()+"                                                </div>                                                <div>                                                    <div><span>"+e.amount+"<span>元</span></span><span>原价：<span>"+e.price+'</span>元</span></div>                                                </div>                                                <div>                                                    <div class="countDown">                                                        <div>揭晓倒计时：</div>                                                        <div>00</div>                                                        <div>时</div>                                                        <div>00</div>                                                        <div>分</div>                                                        <div>00</div>                                                        <div>秒</div>                                                    </div>                                                    <div>                                                        <div>开奖进度：</div>                                                        <div>'+(e.paidCount/e.totalPaidCount*100).toFixed(0)+'%</div>                                                        <div>                                                            <div style="width:'+(e.paidCount/e.totalPaidCount*100).toFixed(0)+'%"></div>                                                        </div>                                                        <div>                                                            <div>                                                                <div>一元抢</div>                                                                <div></div>                                                            </div>                                                        </div>                                                    </div>                                                </div>                                                <div>已揭晓</div>                                            </div>                                        </div>                                    </div>'))}),t.length>0&&($(".activity").ClassClear("hide"),$(".activity>div:nth-of-type(2)").Html(t.join("")).Delegate("click",".act-paid_item",function(e,t){b[t.dataset.actIndex]!==!0&&$.page("robProjectDetail&robProjectId="+t.dataset.actId)}).Delegate("click",".act-one_yuan",function(e,t){$.page("oneYuanDetail&oneYuanId="+t.dataset.itemId)}),b.forEach(function(e,t){"paid_item"==e.actType&&e!==!0?+function(e,t){var i,a,n,d,o,c,v,s=["揭晓倒计时：","00","时","00","分","00","秒"],l=$(".activity .act-paid_item:nth-of-type("+(t+1)+") .count-down>div"),r=function(){l.Index(0).Text(s[0]),l.Index(1).Text(s[1]),l.Index(2).Text(s[2]),l.Index(3).Text(s[3]),l.Index(4).Text(s[4]),l.Index(5).Text(s[5]),l.Index(6).Text(s[6])};new Date-new Date(e.startDate.replace(/-/g,"/")).getTime()<0?(s[0]="距开始：",i=new Date(e.startDate.replace(/-/g,"/"))):new Date-new Date(e.endDate.replace(/-/g,"/")).getTime()<0&&(s[0]="距结束：",i=new Date(e.endDate.replace(/-/g,"/"))),r(),(a=function(){var l=new Date;if(i-l>0){var u=(i-l)/1e3;c=~~(u%60),o=~~(u/60%60),d=~~(u/3600%24),n=~~(u/3600/24),n>0?(s=[s[0],n<10?"0"+n:n,"天",d<10?"0"+d:d,"时",o<10?"0"+o:o,"分"],v=1e3*(c+1)):(s=[s[0],d<10?"0"+d:d,"时",o<10?"0"+o:o,"分",c<10?"0"+c:c,"秒"],v=1e3),setTimeout(a,v)}else"距开始："==s[0]?(s[0]="距结束：",i=new Date(e.endDate.replace(/-/g,"/")),a()):($(".activity .act-paid_item:nth-of-type("+(t+1)+")").Class("act-end"),$(".activity .act-paid_item:nth-of-type("+(t+1)+")>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>div>div:nth-of-type(1)").Text("抢光了"));r()})()}(e,t):"one_yuan"==e.actType&&e&&+function(e,t){var i,a,n,d,o,c,v,s=new Date(e.completeTime),l=["距开始：","00","时","00","分","00","秒"],r=$(".activity .act-one_yuan:nth-of-type("+(t+1)+") .countDown>div"),u=function(){r.Index(0).Text(l[0]),r.Index(1).Text(l[1]),r.Index(2).Text(l[2]),r.Index(3).Text(l[3]),r.Index(4).Text(l[4]),r.Index(5).Text(l[5]),r.Index(6).Text(l[6])},p=new Date;s-new Date($.commonDateFormat(p,"yyyy/MM/dd 20:30:00"))>0&&p.setDate(p.getDate()+1),i=new Date($.commonDateFormat(p,"yyyy/MM/dd 21:00:00")),(a=function(){var e=new Date;if(i-e>0){var s=(i-e)/1e3;c=~~(s%60),o=~~(s/60%60),d=~~(s/3600%24),n=~~(s/3600/24),n>0?(l=[l[0],n<10?"0"+n:n,"天",d<10?"0"+d:d,"时",o<10?"0"+o:o,"分"],v=1e3*(c+1)):(l=[l[0],d<10?"0"+d:d,"时",o<10?"0"+o:o,"分",c<10?"0"+c:c,"秒"],v=1e3),setTimeout(a,v)}else $(".activity .act-one_yuan:nth-of-type("+(t+1)+")").Class("act-complete");u()})()}(e,t)}))}}}),$(".activity>div:nth-of-type(1)").Page("activities"),$.$.accessMenus.onceCardMall&&!$.$.accessMenus.onceCardMall.isOff&&$.ajax({url:"../api/v2/club/item_card/activity/list",data:{clubId:$.$.clubID},isReplaceUrl:!0,success:function(e){if(200==e.statusCode&&(e=e.respData,e&&e.activityList.length>0)){var t=e.activityList,a=[];a.push(t[0]),a[0].tag="new";var n=1;for(t[0].id!=e.optimalActivity.id&&(a.push(e.optimalActivity),a[1].tag="best");a.length<=3&&n<t.length;)t[n].id!=e.optimalActivity.id&&a.push(t[n]),n++;var d,o,c,v="";for(n=0;n<a.length;n++)for(d=a[n],i=0;i<d.itemCardPlans.length;i++)if(o=d.itemCardPlans[i],"Y"==o.optimal){c=o.actAmount/100/(o.giveCount+o.paidCount),c>1.001?c=Math.round(c):(c<.01&&(c=.01),c=c.toFixed(2));var s=0;0!=d.totalCount&&d.paidCount>.49*d.totalCount&&(s=d.paidCount/d.totalCount*100),v+="<li cardId='"+d.id+"' class='"+("已售完"==d.statusName?"sellOut":"已过期"==d.statusName?"expired":"")+"'>                                                                <div style='background-image: url("+(d.imageUrl||$.$.defaultService)+")'><div>"+d.name+"</div></div>                                                                <div><b>"+c+"</b>元/次<span>买"+o.paidCount+"送"+o.giveCount+"</span></div>                                                                <div>"+Math.round(o.itemAmount/100)+"元/次"+(s?"<div>"+s+"%<div style='left:"+s+"%'></div></div>":"")+"</div>"+(d.tag?"<div class='"+d.tag+"'>"+("new"==d.tag?"最新":"最优惠")+"</div>":"")+"                                                            </li>";break}$(".discount-service").Show(),$(".discount-service>ul")[0].innerHTML=v,$(".discount-service>ul>li").Click(function(e,t){$.page("onceCardDetail&id="+t.getAttribute("cardId"))}),$(".discount-service>div>div:nth-of-type(2)").Click(function(){$.page("discountMall")})}}}),$.pageSwitch()},error:function(e){}})}();