!function(){function e(){a.Event("focus",function(){n.Class("hide")}),a.Event("blur",function(){""==a.Value()&&n.ClassClear("hide")}),a.Event("input",function(){if(""==a[0].value)s.length>1?a[0].value=s:(s="",o.Class("disabled"));else{var e=a[0].value.match(/\./g);e&&a[0].value.match(/\./g).length>1&&(a[0].value=a[0].value.substring(0,a[0].value.length-1)),/^([1-9][0-9]*)$/g.test(a[0].value)?s=a[0].value:a[0].value=s,o.ClassClear("disabled")}}),t.Event("click",function(){a[0].value="",s="",n.ClassClear("hide")}),$.ajax({url:"../api/v2/club/"+l+"/clubName",isReplaceUrl:!0,success:function(e){$("#clubLogo").CSS("backgroundImage","url("+e.logo+")"),$("#clubName").Text(e.name),o.Click(function(){if(!o.ClassHave("disabled")){if(o.ClassHave("processing"))return $.tipShow("正在处理中，请稍候...");o.Class("processing"),o.Text("支付...");var e={businessChannel:"link",amount:parseFloat(a.Value()),clubId:l||"",tradeChannel:"wx",openId:i};$.ajax({url:"../api/v2/wx/pay/consume/save",isReplaceUrl:!0,type:"post",data:e,success:function(a){function n(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a["package"],signType:a.signType,paySign:a.paySign},function(a){o.ClassClear("processing"),o.Text("确认支付"),a.err_msg.indexOf("ok")>=0?($.tipShow("支付成功！"),$.page("qrPayComplete&clubId="+e.clubId+"&money="+e.amount)):$.tipShow("未能成功支付！")})}200==a.statusCode?($.$.payToken=a.respData.token,a=JSON.parse(a.respData.payInfo),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n)):n()):"935801"==a.statusCode?($.localStorage("con-qrpay-param",JSON.stringify(e)),$.getOauthCode("","9358","confirm-qrpay","base")):(o.ClassClear("processing"),o.Text("确认支付"),$.tipShow(a.msg||"支付失败！"))},error:function(){o.ClassClear("processing"),o.Text("确认支付"),$.tipShow("error")}})}}),c&&($.localStorageClear("con-recharge-param"),a[0].value=c.amount,o.ClassClear("disabled"),o[0].click())}}),$.pageSwitch()}var a=$("#moneyInput"),n=$("#inputPlaceholder"),t=$(".money-info > div:nth-of-type(2) > div > i"),o=$("#sureBtn"),s="",i=$.localStorage("_qrpay_user_open_id")||"",l=$.param("clubId")||$.getUrlParam("clubId")||"",r=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,c=$.localStorage("con-qrpay-param")?JSON.parse($.localStorage("con-qrpay-param")):null;if($.$.ua.isWX)if(!i||i.length<10){if((new Date).getTime()-($.getUrlParam("_t")||0)>24e3||!r)return void $.getOauthCode("","9358","confirm-qrpay","base");$.ajax({url:"../api/v2/wx/oauth2/openid",isReplaceUrl:!0,data:{code:r,scope:"snsapi_base",wxmp:"9358",openId:"",webSessionId:""},success:function(a){if(200==a.statusCode)i=a.respData.openid,$.localStorage("_qrpay_user_open_id",i),e();else{if("40029"!=a.statusCode)return $.tipShow(a.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","confirm-qrpay","base")}}})}else e();else e()}();