!function(){function e(){function e(){$.ajax({url:"../api/v2/club/"+t+"/coupons",isReplaceUrl:!0,data:{clubId:t},success:function(e){function i(e,i){function o(){$.updateSessionList(s,"text",!1),$.addToMsgList(s,"text"),$.page("paidCouponDetail&userActId="+e)}var a=$.$.userHeader,d=$.$.userName==$.$.defaultUserName?$.$.defaultUserName+"("+$.$.userTel.substr(0,3)+"****"+$.$.userTel.slice(-4)+")":$.$.userName,c=$.$.easemob,s={from:c.userId,to:n.emchatId,data:"您购买了"+n.name+'的"'+i.actTitle+'"',ext:{name:n.name,header:n.avatarUrl,avatar:"",no:n.serialNo,techId:n.id,clubId:t,msgType:"paidCouponTip"}},l=setTimeout(function(){s.status=0,o()},5e3);c.conn.isOpened()&&c.conn.send({to:n.emchatId,msg:i.actTitle+"&"+i.actId,type:"chat",ext:{name:d,header:a,msgType:"paidCouponTip",time:Date.now(),avatar:$.$.userAvatar},success:function(){$.sendFriend(n.emchatId,"business_process"),clearTimeout(l),s.status=1,o()}})}if(200==e.statusCode){var a=$("#couponList"),d=[],c=[];e=e.respData.coupons||[],e.sort(function(e,t){return e.useType>=t.useType?t.consumeMoney-t.actValue-(e.consumeMoney-e.actValue):-1}),e.forEach(function(e){"paid"==e.couponType?c.push('<div class="hour-coupon">                              <div data-act-id="'+e.actId+'">                                <div>'+e.actTitle+"</div>                                <div>"+e.consumeMoneyDescription+'</div>                              </div>                              <div>                                <div>点钟券</div>                                <div class="sure-btn" data-act-id="'+e.actId+'" data-act-value="'+e.actValue+'" data-act-title="'+e.actTitle+'">立即购买</div>                              </div>                            </div>'):d.push('<div class="money-coupon">                              <div data-act-id="'+e.actId+'">                                <div>'+e.actTitle+"</div>                                <div>"+("money"==e.useType?e.actValue+"元现金券，":"")+e.consumeMoneyDescription+"</div>                              </div>                              <div>                                <div>"+e.useTypeName+'</div>                                <div class="sure-btn '+("already_get"==e.getFlag||"finish_get"==e.getFlag?"disabled":"")+'" data-act-id="'+e.actId+'" data-act-value="'+e.actValue+'" data-act-title="'+e.actTitle+'" data-user-get-count="'+e.userGetCount+'"  data-user-get-counts="'+e.userGetCounts+'">'+("already_get"==e.getFlag?"已领取":"finish_get"==e.getFlag?"已领完":"立即领取")+"</div>                              </div>                            </div>")}),0==c.length&&$("#couponList>div>div:nth-of-type(2)>div:nth-of-type(1)").CSS("display","none"),0==d.length&&$("#couponList>div>div:nth-of-type(2)>div:nth-of-type(2)").CSS("display","none"),$("#couponList>div>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(2)").Html(c.join("")),$("#couponList>div>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Html(d.join("")),(c.length>0||d.length>0)&&$("#paidCoupon").Event("click",function(){a.Class("active")}).ClassClear("hide"),$("#couponList>div>div:nth-of-type(1)>div").Click(function(){a.ClassClear("active")}),a.Delegate("click",".hour-coupon .sure-btn",function(e,n){var a=$(n),d=n.dataset;return $.$.ua.isWX?$.$.userToken?$.$.userTel?a.ClassHave("processing")?$.tipShow("购买中,请稍候..."):(a.Class("processing"),a.Text("购买中..."),void $.ajax({url:"../api/v2/wx/pay/paid_coupon",isReplaceUrl:!0,type:"post",data:{actId:d.actId,businessType:"paid_coupon",businessChannel:$.param("chanel")||"link",clubId:t,money:d.actValue,openId:$.$.openId,techId:o,tradeChannel:"wx",token:$.$.userToken,sessionType:$.$.sessionType},success:function(e){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp+"",nonceStr:e.nonceStr,"package":e["package"],signType:e.signType,paySign:e.paySign},function(t){if(a.ClassClear("processing").Text("立即购买"),t.err_msg.indexOf("ok")>=0){$.tipShow("支付成功！"),a.Text("购买成功");var n=$.$.easemob;if(n.userId&&!n.conn.isOpened())var o=setInterval(function(){n.conn.isOpened()&&(clearInterval(o),i(e.bizId,d))},10);else i(e.bizId,d)}else $.tipShow("未能成功支付！")})}200==e.statusCode?(e=JSON.parse(e.respData),"undefined"==typeof WeixinJSBridge?doc.addEventListener?doc.addEventListener("WeixinJSBridgeReady",t,!1):doc.attachEvent&&(doc.attachEvent("WeixinJSBridgeReady",t),doc.attachEvent("onWeixinJSBridgeReady",t)):t()):"935801"==e.statusCode?($.localStorage("paid-coupon-param",!0),$.getOauthCode("","9358","paid-coupon","base")):(a.ClassClear("processing").Text("立即购买"),$.tipShow(e.msg||"购买点钟券请求失败！"))},error:function(){a.ClassClear("processing").Text("立即购买")}})):($.$.loginUrl=location.hash,$.bindPhone(!1),!0):($.tipShow("请您先登录！"),$.$.loginUrl="paidCoupon"+location.hash.split("paidCoupon")[1],$.page("login"),!0):$.tipShow("需在微信中打开才可购买")}).Delegate("click",".money-coupon .sure-btn",function(e,t){var i=$(t),o=t.dataset;if(!i.ClassHave("disabled")){if(!$.$.userToken)return $.$.loginUrl=location.hash,$.page("login"),!0;if(!$.$.userTel)return $.$.loginUrl=location.hash,$.bindPhone(!1),!0;if(i.ClassHave("processing"))return $.tipShow("领取中,请稍候...");i.Class("processing"),i.Text("领取中..."),$.ajax({url:"../get/redpacket",data:{actId:o.actId,phoneNum:$.$.userTel,openId:$.$.openId,techCode:n.inviteCode||""},success:function(e){i.ClassClear("processing").Text("立即领取"),200==e.statusCode?(o.userGetCount-0>o.userGetCounts-0+1?t.dataset.userGetCounts=o.userGetCounts-0+1:i.Text("已领取").Class("disabled"),$.tipShow("领取成功")):206==e.statusCode?(i.Text("已领取").Class("disabled"),$.tipShow(e.msg||"你已经领取过了！")):$.tipShow(e.msg||"领取失败！")},error:function(e){e.msg&&$.tipShow(e.msg),i.ClassClear("processing").Text("立即领取")}})}}),$(".hour-coupon>div:nth-of-type(1)").Click(function(e,t){$.page("paidCoupon&actId="+t.dataset.actId+"&techCode="+n.inviteCode+"&chanel="+($.param("chanel")||"link"))})}else $.tipShow(e.msg||"查询优惠券列表失败")}})}$("#content").CSS("overflow-y","hidden"),$.ajax({url:($.$.clubID?"../":"")+"/technician/"+o,success:function(a){function d(){function e(){var n=[];if(d[5]>0)d=[d[0],d[1],d[2],d[3],d[4],d[5]-1],n=n.concat([5]);else if(d[4]>0)d=[d[0],d[1],d[2],d[3],d[4]-1,9],n=n.concat([4,5]);else if(d[3]>0)d=[d[0],d[1],d[2],d[3]-1,5,9],n=n.concat([3,4,5]);else if(d[2]>0)d=[d[0],d[1],d[2]-1,9,5,9],n=n.concat([2,3,4,5]);else if(d[1]>0)d=[d[0],d[1]-1,5,9,5,9],n=n.concat([1,2,3,4,5]);else{if(!(d[0]>0))return!0;d=[d[0]-1,9,5,9,5,9],n=n.concat([0,1,2,3,4,5])}t(n),setTimeout(e,1e3)}function t(e){e.forEach(function(e){p.Index(e).Children().Index(0).Text(d[e]),r.Index(e).Class("toggle")})}var n,i,o,a,d,l=(Math.round,Math.floor),r=$("#content>div:nth-of-type(1)>div:nth-of-type(2)>span"),p=$("#content>div:nth-of-type(1)>div:nth-of-type(2)>span>div");n=c-s,c=n/1e3,c>0&&(i=l(c%60),o=l(c/60%60),a=l(c/3600%24),d=[l(a/10),a%10,l(o/10),o%10,l(i/10),i%10],p.Index(0).Children().Text(d[0]),p.Index(1).Children().Text(d[1]),p.Index(2).Children().Text(d[2]),p.Index(3).Children().Text(d[3]),p.Index(4).Children().Text(d[4]),p.Index(5).Children().Text(d[5]),setTimeout(e,n%1e3),r.Event(function(){var e,t=document.createElement("tmpelement"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",MsTransition:"msTransitionEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}(),function(e,t){var n=$(t),i=n.Children().Index(0).Children();i.Index(1).Text(i.Index(0).Text()),n.ClassClear("toggle")}))}if(!a.id)return $.tipShow(a.msg||"无相关技师信息"),$.pageCancel();$.pageSwitch(!1,!1),$("#backHome").Click(function(){$.$.clubID?$.page("home",-1,!0):location.href=location.origin+location.pathname+"?club="+a.info.clubId+"#home"+("9358"==$.$.visitChannel?"&clubsource=9358":"")}),i="true"===a.hasInnerProvider;var c,s=+new Date;i&&"busy"==a.info.status&&a.info.endTime&&(c=+new Date(a.info.endTime.replace(/-/g,"/")),c-s>0&&($("#content>div:nth-of-type(1)").Class("cross-inner"),d()));var l,r,p,u,v,h="",f="",y=$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(3)"),C=$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(3)>span"),g=$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(3)>div:nth-of-type(2)"),m=$("#footer>div:nth-of-type(4)"),T=$("#telDetail"),I=!1;for(t=a.info.clubId,n=a.info,n.emchatId=a.emchatId,e(),g.Text(a.favoriteCount),$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").CSS("backgroundImage","url("+(a.info.avatarUrl||$.$.defaultHeader)+")"),$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(a.info.name||$.$.defaultTechName),a.info.serialNo?$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").Text(a.info.serialNo):$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").Hide(),$("#content>div:nth-of-type(3)>div:nth-of-type(2)>div:nth-of-type(1)>div").CSS("width",(a.info.star||0)+"%"),$("#content>div:nth-of-type(3)>div:nth-of-type(2)>div:nth-of-type(2)").Text((a.info.commentCount||0)+"评论"),$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)").Text({free:"闲",busy:"忙",rest:"休"}[a.info.status]),$("#content>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)").Class(a.info.status),a.info.description?$("#content>div:nth-of-type(1)>div:nth-of-type(3)").Html(a.info.description||""):$("#content>div:nth-of-type(1)>div:nth-of-type(3)").Hide(),setTimeout(function(){$("#content").CSS("overflow-y","auto")},1e3),r=0,l=a.service.length;r<l;r++)h+='<div hh="'+a.service[r].id+'">                        <div></div>                        <div style="background-image: url(\''+(a.service[r].imageUrl||$.$.defaultService)+"')\"></div>                        <div>"+(a.service[r].name||"")+"</div>                        <div>                            <div>"+$.formatPrice(a.service[r].price1,a.service[r].duration1,a.service[r].durationUnit)+"</div>                            <div>"+$.formatPrice(a.service[r].price2,a.service[r].duration2,a.service[r].durationUnitPlus)+"</div>                        </div>                    </div>";if(""==h?$("#content>div:nth-of-type(5)").Hide():($("#content>div:nth-of-type(5)>div:nth-of-type(2)").Html(h),$("#content>div:nth-of-type(5)>div:nth-of-type(2)>div").Click(function(e,t){"selected"!=t.className?($("#content>div:nth-of-type(5)>div:nth-of-type(2)>div.selected").ClassClear("selected"),t.className="selected",v=t.getAttribute("hh")):(t.className="",v=null)})),"y"==(a.isFavorite||"n").toLowerCase()&&y.Class("collected"),"n"==(a.appointment||"y").toLowerCase()&&"n"==(a.phoneAppointment||"y").toLowerCase()||m.Class("active"),h="",""!=a.telephone)for(r=0,f=a.telephone.split(","),length=f.length;r<length;r++)h+="<div>"+f[r]+"</div>";$("#telDetail>div").Html(h+"<div>取消</div>"),$("#content>div:nth-of-type(3)")[0].onclick=function(){$.page("review&id="+$.param("id"))},$("#content>div:nth-of-type(4)")[0].onclick=function(){$.$.clubID?$.page("technicianList",1,!0):location.href=location.origin+location.pathname+"?club="+t+"#technicianList"+("9358"==$.$.visitChannel?"&clubsource=9358":"")};var b=null;y.Click(function(){if(!$.$.userToken)return $.$.loginUrl="technicianDetail&id="+$.param("id"),void $.page("login");var e=y.ClassHave("collected");b&&(clearTimeout(b),C.CSS("display","none"),C.ClassClear("active")),$.ajax({url:($.$.clubID?"../":"")+"../profile/user/favorite/"+(e?"delete":"create"),data:{id:$.param("id")},success:function(){e?y.ClassClear("collected"):y.Class("collected"),e?(C.Text("已取消"),g.Text(g.Text()-1)):(C.Text("已收藏"),g.Text(g.Text()-0+1)),C.CSS("display","block"),C.Class("active"),b=setTimeout(function(){C.CSS("display","none"),C.ClassClear("active")},1100)}})}),$.ajax({url:"../api/v2/user/reward/isRewardOn",data:{clubId:t},isReplaceUrl:!0,success:function(e){200==e.statusCode&&(I=e.respData)}}),$("#footer>div:nth-of-type(3)").Click(function(){history.replaceState&&history.replaceState(null,document.title,location.search+location.hash.toString().replace(new RegExp("chat&techId="+o+("9358"==$.$.visitChannel?"&clubId="+a.info.clubId:"")+"[^/]*/"),"")),$.login("chat&techId="+o+("9358"==$.$.visitChannel?"&clubId="+a.info.clubId:"")+"&backPublic=true")}),m.Click(function(e,t){if(m.ClassHave("active"))if("phone"==a.appointType){if($.login())return;""==a.telephone?$.tipShow("暂无预约电话"):T.Class("active")}else if("paid"==a.appointType||"paid_full"==a.appointType)if($.$.ua.isWX){if((i||"paid_full"==a.appointType)&&!v)return void $.tipShow("必须选择一个服务项目",4e3);$.login("confirmOrder&techId="+o+(v?"&itemId="+v:"")+("9358"==$.$.visitChannel?"&clubId="+a.info.clubId:""),!1,!0,!0)}else $.checkAccessMenu("confirmOrder")&&$.tipShow("【此会所需支付预约，请在微信中打开】");else"appoint"==a.appointType?$.login("confirmOrder&techId="+o+(v?"&itemId="+v:"")+("9358"==$.$.visitChannel?"&clubId="+a.info.clubId:""),!1,!0,!0):$.tipShow("此会所不支持线上预约。")}),T.Event("touchmove",function(e){e.preventDefault()},!1),T.Click(function(e,t){e.target==t&&T.ClassClear()}),p=$("#telDetail>div>div"),u=p.Remove(p.length-1),p.Click(function(e,t){location.href="tel:"+t.innerHTML}),u.Click(function(){T.ClassClear()}),$.$.ua.isWX&&$.X5Config({title:(a.info.name||$.$.defaultTechName)+"欢迎您",desc:"点我聊聊，更多优惠，更好服务！",link:location.href.split("?")[0]+"?club="+a.info.clubId+"#technicianDetail&visitChannel=9358&isNeedFollow=true&id="+$.param("id"),imgUrl:a.info.avatarUrl||$.$.defaultHeader}),$("#footer>div:nth-of-type(1)").Click(function(){1==a.toDayCommentCount?$.tipShow("您今天已经评论过该技师了"):$.login("comment&techId="+o+"&type=tech&backPublic=true")}),$("#footer>div:nth-of-type(2)").Click(function(){return I?void($.$.ua.isWX?$.login("techReward&techId="+o+"&backPublic=true"):$.tipShow("请在微信中打开",4e3)):$.tipShow("会所关闭了打赏！")})},error:function(e){$.tipShow(e),$.pageCancel()}});var a=$.$.clubSource;a||(a=$.getUrlParam("clubsource")||"link",a&&/wifi/.test(a)&&(a="wifi")),$.ajax({url:"../api/v2/club/tech/albums/"+o,isReplaceUrl:!0,data:{source:a},success:function(e){if(200==e.statusCode){if(e=e.respData||[],0==e.length)return void $("#content>div:nth-of-type(2)").Hide();for(var t="",n="",i="",o=0,a=e.length;o<a;o++)e[o].imageUrl&&(t+="<div style=\"background-image: url('"+e[o].imageUrl+"')\"></div>",n+='<img imageCache="'+e[o].bigImageUrl+'"/>',i+="<span></span>");$("#content>div:nth-of-type(2)>div>div")[0].innerHTML=t,$("#_picture>div:nth-of-type(1)")[0].innerHTML=n,$("#_picture>div:nth-of-type(2)")[0].innerHTML=i,""==t?$("#content>div:nth-of-type(2)").Hide():$("#content>div:nth-of-type(2)").Show(),$("#pics>div>div>div").Click(function(e,t,n){l.IndexX(n),s.style.display=""});var d,c,s=$("#_picture")[0];s.addEventListener("touchstart",function(e){d=e.touches[0].clientX,c=Date.now()}),s.addEventListener("touchend",function(e){Date.now()-c<500&&Math.abs(e.changedTouches[0].clientX-d)<20&&(s.style.display="none",e.preventDefault())},!1);var l=$.scroll({content:s,contentX:s.children[0],flagX:s.children[1]});$("#_picture>div:nth-of-type(1) img").ImgSrcCacheBack(!0)}}})}var t,n,i,o=$.param("id"),a=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode;if(!o)return $.tipShow("技师不存在！"),$.pageCancel();if($.$.ua.isWX)if(!$.$.openId||$.$.openId.length<10){if((new Date).getTime()-($.getUrlParam("_t")||0)>24e3||!a)return void $.getOauthCode("","9358","confirm-tech-pay","base");$.ajax({url:"../api/v2/wx/oauth2/openid",isReplaceUrl:!0,data:{code:a,scope:"snsapi_base",wxmp:"9358",openId:"",webSessionId:""},success:function(t){if(200==t.statusCode)$.$.openId=t.respData.openid,e();else{if("40029"!=t.statusCode)return $.tipShow(t.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","confirm-tech-pay","base")}}})}else e();else e()}();