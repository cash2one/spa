!function(){function l(l){o||(o=!0,c=l||c+1,u.ClassClear("none"),d.Class("none"),f=!1,$.ajax({url:"../api/v2/club/once_card/order/list",isReplaceUrl:!0,data:{clubId:p,page:c,pageSize:n},success:function(l){if(200==l.statusCode){for(l=l.respData||[],a={},m=0;m<l.length;m++)e=l[m],t=a[e.clubId],t||(t=a[e.clubId]=[]),t.push(e);for(var s in a)i(s,a[s]);1==c?(0==l.length&&(g.Show(),r.Hide(),f=!0),v=r[0].scrollHeight):l.length<n&&(f=!0,d.ClassClear("none")),o=!1,u.Class("none")}else $.tipShow(l.msg||"查询数据失败！")}}))}function i(l,i){var a=$(".all-list>li.club_"+l);a[0]||(r[0].innerHTML+="<li class='club_"+l+"'>                                                        <div class='item-title'><div style='background-image:url("+(i[0].clubImageUrl||$.$.defaultClubLogo)+")'></div>"+i[0].clubName+"</div>                                                        <ul class='item-list'></ul>                                                    </li>",$(".all-list>li.club_"+l+">div").Click(function(){$.$.clubID?$.page("home"):location.href=location.origin+"/spa-manager/spa2/?club="+l})),a=$(".all-list>li.club_"+l+">ul")[0];for(var e,t="",n=0;n<i.length;n++)e=i[n],t+="<li class='"+(1==e.status?"":"disabled")+"' orderId='"+e.id+"'>                            <div style='background-image: url("+(e.imageUrl||$.$.defaultService)+")'></div>                            <div>"+e.itemName+"</div>                            <div>总价：<span>"+(e.amount/100).toFixed(2)+"</span>元</div>                            <div>"+(e.useEndTime?"有效期至："+e.useEndTime:"长期有效")+(1==e.status?"<span>剩余 <b>"+(e.totalCount-e.usedCount)+"</b>/"+e.totalCount+"</span>":"")+"</div>                            <div>"+h[e.status]+"</div>                        </li>";a.innerHTML+=t}var a,e,t,n=20,s=.4,o=!1,c=1,u=$("#loadTip"),d=$("#finishTip"),r=$("#content>ul.all-list"),g=$("#content>div.nullData"),b=$("#content"),p=$.param("clubId")||$.$.clubID||"",v=0,f=!1,m=0,h={1:"使用",2:"已过期",3:"用完啦~"};b.Event("scroll",function(){!f&&b[0].scrollTop+b[0].clientHeight-(c+s-1)*v>=0&&l()}),$("#footer").Click(function(){$.$.clubID?$.page("discountMall"):p&&(location.href=location.origin+"/spa-manager/spa2/?club="+p+"#discountMall")}),$.$.clubID||p||$("#footer").Hide(),$(".all-list").Delegate("click",">li>ul.item-list>li",function(l,i){$.page("onceCardOrderDetail&id="+i.getAttribute("orderId"))}),l(1),$.pageSwitch()}();