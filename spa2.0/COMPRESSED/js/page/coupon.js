!function(){function e(e,r){d||(d=!0,v=e||v+1,h.ClassClear("none"),y.Class("none"),m=!1,$.ajax({url:"../api/v2/club/user_get_coupons",isReplaceUrl:!0,data:{loginName:$.$.userLoginName,clubId:$.$.clubID,page:v,pageSize:T},success:function(e){if("200"!=e.statusCode)return $.tipShow(e.msg||"数据请求失败！");if("9358"!=$.$.visitChannel){for(e=e.respData,u="",s=0,a=e.length;s<a;s++)e[s].actTitle&&("paid_service_item"==e[s].useType||"discount_item"==e[s].useType?(c=e[s].clubId+"-service_item",g=!0):(c=e[s].clubId+"-"+e[s].useType,g=!1),p!=c&&(u+='<div class="coupon-type">'+(g?"项目抵用券":e[s].useTypeName)+"</div>",p=c),u+=o(e[s]));1==v?(l.Html(u),u?l.ClassClear("nullData"):(l.Class("nullData"),m=!0),D=S[0].scrollHeight):(l.Html(u,!0),a<T&&(m=!0,y.ClassClear("none")))}else{for(i={},s=0;s<e.respData.length;s++)i[e.respData[s].clubId]||(i[e.respData[s].clubId]={clubName:e.respData[s].clubName,clubId:e.respData[s].clubId,list:[]}),i[e.respData[s].clubId].list.push(e.respData[s]);u="";var _,f,C,b=0,I="";for(_ in i){if(C=!1,v>1&&0==b&&(f=$("#content>div>div:nth-of-type(2)>div>div:last-child"),f.Attr("hh")==i[_].clubId)){for(n=i[_].list,s=0;s<n.length;s++)I+=o(n[s]);f.Html(I,!0),C=!0}if(!C){for(u+="<div hh='"+i[_].clubId+"'><div class='header'>"+i[_].clubName+"</div>",n=i[_].list,s=0;s<n.length;s++)p!=i[_].clubId+"-"+n[s].useType&&(u+='<div class="coupon-type">'+n[s].useTypeName+"</div>",p=i[_].clubId+"-"+n[s].useType),u+=o(n[s]);u+="</div>"}b++}1==v?(S.Html(u),u?S.ClassClear("nullData"):(S.Class("nullData"),m=!0),D=S[0].scrollHeight):(S.Html(u,!0),e.respData.length<T&&(m=!0,y.ClassClear("none")))}t(),d=!1,h.Class("none"),r&&r()}}))}function o(e){var o="已过期"==e.couponStatusDescription||"已使用"==e.couponStatusDescription,t="paid_service_item"==e.couponType;"money"==e.useType&&0==e.consumeMoney&&(e.consumeMoneyDescription="&nbsp;"),e.credits&&e.credits-0>0&&(e.consumeMoneyDescription=e.credits+" 积分");var s="<div type='"+e.couponType+"' hh='"+e.userActId+"' class='item "+(o?"expire":"")+"'>                        <i></i>                        <div>"+(e.actTitle+(t||g?"券":""))+"</div>                        <div>"+("money"==e.useType?e.actValue+"元现金券，":"")+e.consumeMoneyDescription+"</div>                        <div>券有效期："+(t||g?e.couponPeriod.replace(/(\d{2}:\d{2})(:\d{2})/g,"$1"):e.couponPeriod)+"</div>                        <div>"+e.useTypeName+"</div>";return o?s+="<span>"+e.couponStatusDescription+"</span>":"paid"==e.couponType&&(s+="<span class='"+(0==e.couponStatus?"unpay":1==e.couponStatus?"payed":"expire")+"'>"+e.couponStatusDescription+"</span>"),s+="<div style='display:"+("redpack"==e.couponType?"block":"none")+"'>分享获得更多优惠机会</div>",s+="</div>"}function t(){$("div#coupon #content>div>div:nth-of-type(2)>div>div>div.item",!0).Event("click",function(e,o){$.sessionStorage("coupon_data",S.Html()),$.sessionStorage("coupon_page",v),$.sessionStorage("coupon_page_height",D),$.sessionStorage("coupon_end",m),$.sessionStorage("coupon_ID",JSON.stringify(r)),$.sessionStorage("coupon_top",_[0].scrollTop),"paid"==o.getAttribute("type")?$.page("paidCouponDetail&userActId="+o.getAttribute("hh")):$.page("couponDetail&userActId="+o.getAttribute("hh")+"&couponType="+o.getAttribute("type"))},!0)}var s,i,n,a,p,c,l,u="",r=JSON.parse($.sessionStorage("coupon_ID")||"{}"),d=!1,g=!1,v=1,h=$("#loadTip"),y=$("#finishTip"),m="true"==($.sessionStorage("coupon_end")||"false"),S=$("#content>div>div:nth-of-type(2)>div"),_=$("#content"),f=$.sessionStorage("coupon_top"),C=$.sessionStorage("coupon_page"),b=$.sessionStorage("coupon_data"),D=$.sessionStorage("page_height")||0,T=10,I=.4;"9358"!=$.$.visitChannel?(S.Html("<div></div>"),l=$("#content>div>div:nth-of-type(2)>div>div")):"true"==$.param("backPublic")&&$("#title>div:nth-of-type(2)").Click(function(e){e.stopImmediatePropagation(),history.back()});var H=$.getUrlParams("loginTel")[0];return H&&H!=$.$.userTel?($.$.loginUrl="coupon",$.$.userToken=null,void $.page("login")):(_.Event("scroll",function(o){!m&&_[0].scrollTop+_[0].clientHeight-(v+I-1)*D>=0&&e()}),b?(v=parseInt(C),S.Html(b),setTimeout(function(){_[0].scrollTop=f},1),t(),m&&y.ClassClear("none"),$.pageSwitch()):e(1,function(){$.pageSwitch()}),$.sessionStorageClear("coupon_ID"),$.sessionStorageClear("coupon_data"),$.sessionStorageClear("coupon_end"),$.sessionStorageClear("coupon_top"),$.sessionStorageClear("coupon_page"),void $.sessionStorageClear("coupon_page_height"))}();