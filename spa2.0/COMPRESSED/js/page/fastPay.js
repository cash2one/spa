!function(){function e(){$.ajax({url:"../api/v2/club/fastpay/tech/get",isReplaceUrl:!0,data:{techId:t},success:function(e){if(200==e.statusCode)e=e.respData,$(".top-wrap>div.name").Html(e.techName+(e.techNo?"<span>"+e.techNo+"</span>":"")),$(".top-wrap>div.header").CSS("background-image","url("+(e.avatarUrl||$.$.defaultHeader)+")"),s=e.clubId,p=$.$.winHeight/(16*$.$.scale)-24.4444,c.ClassClear("fixed"),c.CSS("margin-top",p+"rem"),$.pageSwitch(),o&&(a[0].value=o,r[0].click());else{var t=e.msg||"未能获取到技师信息！";$.tipShow(t),$.page("fastPayError&info="+encodeURIComponent(t))}}})}var a=$(".center-wrap>input"),t=$.param("techId"),s="",n=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,o=$.sessionStorage("fast-pay-param"),r=$(".bottom-wrap>div:nth-of-type(2)>div:nth-of-type(2)"),i=document,p=0,c=$(".bottom-wrap");return $.$.payAuthCode=n,$.$.accessMenus.fastPayRecords.isOff?void $.page("fastPayError&info="+encodeURIComponent("在线买单功能已关闭！")):(t||($.tipShow("缺少页面访问参数！"),$.pageCancel()),o&&n?$.ajax({url:"../wx/oauth2/user/openid",isReplaceUrl:!0,type:"post",data:{code:$.$.payAuthCode,scope:"snsapi_base",wxmp:"9358",userType:"user",state:"fast-pay"},success:function(a){if(200==a.statusCode)e();else{if("935801"!=a.statusCode)return $.tipShow(a.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","fast-pay","base")}}}):e(),$(".bottom-wrap>div:nth-of-type(2)>div:nth-of-type(1)").Click(function(){$.page("comment&techId="+t+"&type=tech&from=fastPay")}),r.Click(function(){if($.$.ua.isWX){var e=a.Value();if(!e)return $.tipShow("请输入消费金额！");if(parseFloat(e)<.001)return $.tipShow("买单金额不能为0！");if(!(parseFloat(e)<5000.001))return $.tipShow("单笔支付请不要超过5000元！");if(r.ClassHave("processing"))return $.tipShow("支付中，请稍候...");r.Class("processing").Text("支付中..."),$.ajax({url:"../api/v2/wx/pay/fast_pay/save",isReplaceUrl:!0,type:"post",data:{amount:100*e,clubId:s,techId:t},success:function(a){function s(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a["package"],signType:a.signType,paySign:a.paySign},function(e){r.ClassClear("processing"),e.err_msg&&e.err_msg.indexOf("ok")>=0?($.tipShow("支付成功！"),$.page("comment&techId="+t+"&type=tech&from=fastPay")):(r.Text("确认"),$.tipShow("未能成功支付！"))})}200==a.statusCode?(a=JSON.parse(a.respData),"undefined"==typeof WeixinJSBridge?i.addEventListener?i.addEventListener("WeixinJSBridgeReady",s,!1):i.attachEvent&&(i.attachEvent("WeixinJSBridgeReady",s),i.attachEvent("onWeixinJSBridgeReady",s)):s()):"935801"==a.statusCode?($.sessionStorage("fast-pay-param",e),$.getOauthCode("","9358","fast-pay","base")):($.tipShow(a.msg||"支付失败！"),r.ClassClear("processing").Text("确定"))},error:function(){$.tipShow("请求支付失败！"),r.ClassClear("processing").Text("确定")}})}else $.tipShow("请在微信中打开！")}),a.Event("input",function(e,a){var t=a.value;if(1==t.length)/\D/.test(t)&&(t="");else{t=t.replace(/[^\d.]/g,"");var s=0;t=t.replace(/\./g,function(){return 0==s?(s=arguments[1],"."):""}),s>0&&(t=t.substring(0,s+3))}t.length>7&&(t=t.substr(0,7)),a.value=t}),a.Event("focus",function(){$(".top-wrap").Class("act"),c.CSS("margin-top",p+3+"rem")}),void a.Event("blur",function(){$(".top-wrap").ClassClear("act"),c.CSS("margin-top",p+"rem")}))}();