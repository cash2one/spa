!function(){function e(){D=$("#content div.fourth-page>div.list"),M=$("#content div.fourth-page>div:nth-of-type(2)"),U=$("#content div.fourth-page>div:nth-of-type(2)>span"),A=$("#content div.fourth-page>div:nth-of-type(2)>img"),P=$("#content div.fourth-page>div:nth-of-type(3)"),E=$("div#content>div:nth-of-type(1)>div:nth-of-type(1)>div:last-child"),j=$("#searchArea>div:nth-of-type(3)"),N=$("#searchArea input"),O=$("#searchArea"),F=$("#searchArea>div:nth-of-type(2)"),Z=$("#content div.fifth-page>div.list"),ee=$("#content div.fifth-page>div:nth-of-type(2)"),te=$("#content div.fifth-page>div:nth-of-type(3)"),X=$(".show-area"),k=$("#filterMenu>div:not(:nth-of-type(4))>div"),T=$("#clubFilterPop")}function t(){var e,t,i=new AMap.LngLat($.$.currLngx,$.$.currLaty);e=new AMap.Map("mapInfo",{resizeEnable:!1,view:new AMap.View2D({zoom:15,center:i})}),e.plugin(["AMap.Geocoder"],function(){t=new AMap.Geocoder({radius:1e3,extensions:"all"}),AMap.event.addListener(t,"complete",a),t.getAddress(i)})}function a(e){Y=e.regeocode.addressComponent.city||e.regeocode.addressComponent.province,q=e.regeocode.addressComponent.district,c()}function i(e){G=e,X.Children().Class("hide").Index(e-1).ClassClear("hide")}function s(){function t(){if(J=G=K?4:1,i(G),$.param("search_text")&&(k.ClassClear("active"),T.ClassClear("active"),x.ClassClear("no-scroll"),L.Class("hide"),a(),N[0].value=decodeURIComponent($.param("search_text")),z=!1,s()),1==J)l();else if(4==J){w=0,$("#filterMenu>div:nth-of-type(1)>span").Text("全部会所");var e=$("#filterMenu>div:nth-of-type(1)>ul>li").ClassClear("selected");e.Index(e.length-1).Class("selected"),n()}d()}function a(){de=G,O.ClassClear("hide"),G=2,i(G)}function s(){N.Value().trim()?(W=N.Value().trim(),2==G||3==G?($(".third-page>div:nth-of-type(3)").ClassClear("hide"),$(".third-page>div:nth-of-type(1),.third-page>div:nth-of-type(2)").Class("hide"),G=3,i(G),r(!0)):(G=5,i(G),p(!0))):3!=G&&4!=G||(G=2,i(G))}"none"==$("#_publicMenu",!0)[0].style.display&&($("#_publicMenu",!0)[0].style.display="block",$("#_publicMenu>.clubList",!0).Class("active"),$("#content",!0).ClassClear("noneMenu"));for(var c=0,h=se.length-1;c<h;c++)$.localStorageClear(se[c]);if(se=se.slice(se.length-1)||[],ne&&Date.now()-parseInt(ne,36)<18e5){le=$.localStorage(ne),$.localStorageClear(ne);try{le=JSON.parse(le),J=le.initShowPageIndex,G=le.showPageIndex,$("#content").Html(le.data),e(),ie=le.searchType5,N[0].value=le.searchText,setTimeout(function(){$("#content")[0].scrollTop=le.scrollTop},10),$(".has-event").ClassClear("has-event"),o()}catch(v){le=null,t()}}else t();E.Event("click",a),F.Event("click",function(){3==G||5==G?G=2:(G=4,O.Class("hide"),L.ClassClear("hide")),i(G),N[0].value=""}),j.Click(function(){s()}),H.Click(function(){k.ClassClear("active"),T.ClassClear("active"),x.ClassClear("no-scroll"),L.Class("hide"),a()}),M.Click(function(){n()}),ee.Click(function(){p()}),$("#content").Event("scroll",function(e,t){t.scrollTop+1.4*$.$.winHeight>t.scrollHeight&&(4!=G||_?5!=G||ae||p():n())}),"Y"!=$.$.isLogin&&(M.CSS("display","none"),D.Class("nodata")),k.Click(function(e,t){var a=$(t),i=a.ClassHave("active"),s=t.dataset.type;if(i)a.ClassClear("active"),T.ClassClear("active"),x.ClassClear("no-scroll");else{switch(k.ClassClear("active"),a.Class("active"),s){case"distance":T.ClassClear("show-sort").ClassClear("show-filter").Class("show-distance");break;case"sort":T.ClassClear("show-distance").ClassClear("show-filter").Class("show-sort");break;case"filter":T.ClassClear("show-sort").ClassClear("show-distance").Class("show-filter")}T.Class("active"),x.Class("no-scroll")}});var u=$(".pop-select-layer>div>div>div"),f=$("#filterMenu>div:nth-of-type(1)>div"),g=$("#filterMenu>div:nth-of-type(2)>div"),y=$("#filterMenu>div:nth-of-type(3)>div");u.Event("click",function(e,t){var a,i;if("active"!=t.className){switch(a=$(t.parentNode),i=a.Children(),i.ClassClear("active"),$(t).Class("active"),a[0].id){case"distancePop":f.Text($(t).Text()),w=t.dataset.item;break;case"sortPop":g.Text($(t).Text()),I=t.dataset.item;break;case"filterPop":y.Text($(t).Text()),S=t.dataset.item}T.ClassClear("active"),x.ClassClear("no-scroll"),k.ClassClear("active"),D.ClassClear("nodata"),m=1,_=!1,n()}}),$("div.first-page>div:first-child,div.first-page>div:nth-of-type(4)").Click(function(){D.ClassClear("nodata"),m=1,_=!1,n(),G=4,i(G),$("#showListTitle").ClassClear("hide")}),$("#showListTitle a").Click(function(){$("#showListTitle").Class("hide"),G=J,i(G)}),$(".second-page>div>div:last-child").Delegate("click",">div>div",function(e,t){N[0].value=$(t).Text(),s()}),$(".third-page>div:nth-of-type(1)>div:last-child").Click(function(){ie="club",p(!0),G=5,i(G)}),$(".third-page>div:nth-of-type(2)>div:last-child").Click(function(){ie="tech",p(!0),G=5,i(G)}),$("#content").Delegate("click",".tech-item>div:nth-of-type(2)>div",function(e,t){e.stopPropagation(),e.stopImmediatePropagation(),C(t.dataset.clubId,"technicianDetail&id="+t.dataset.techId)}).Delegate("click",".tech-item>div:nth-of-type(1)",function(e,t){e.stopPropagation(),e.stopImmediatePropagation(),C(t.dataset.clubId)}),$("#content").Event("touchstart",function(e){oe.forEach(function(e){e.stopAnimation()})})}function n(){if(he){if(ue||$e)return}else if(_||R)return;he?$e=!0:R=!0,P.CSS("display","none"),M.CSS("display","block"),U.Text("正在加载"),A.CSS("visibility","visible"),$("#content").ClassClear("over");var e="../api/v2/club/all/clubs";e=he?"../api/v1/wx/visit_clubs/search":e,$.ajax({url:e,isReplaceUrl:!0,type:"get",data:{clubName:encodeURIComponent(encodeURIComponent(N.Value())),pageSize:b,page:he?ve:m,openId:$.$.openId,distance:w,sort:I,loginName:$.$.userLoginName,lngx:$.$.currLngx||"",laty:$.$.currLaty||"",search:"all"==S?"":S},success:function(e){if("200"==e.statusCode){U.Text("点击加载更多"),A.CSS("visibility","hidden");var t="";for(g=0;g<e.respData.length;g++)y.push(e.respData[g]);t=h(e.respData).join("");var a=he?ve:m;1==a?0==e.respData.length?(D.Class("nodata"),he?ue=!0:_=!0):(D.ClassClear("nodata"),D.Html(t)):D.Html(t,!0),e.respData.length<b?(M.CSS("display","none"),(1!=a||1==a&&e.respData.length>0)&&(P.CSS("display","block"),$("#content").Class("over"),he?ue=!0:_=!0)):(M.CSS("display","block"),he?ve++:m++),$(".fourth-page .has-event").ClassClear("has-event"),o()}else e.msg&&($.tipShow(e.msg||"请求会所列表数据失败！"),0==D.Html().length&&(M.CSS("display","none"),D.Class("nodata"),he?ue=!0:_=!0));he?$e=!1:R=!1},error:function(e){he?$e=!1:R=!1}})}function l(){$.ajax({url:"../api/v2/club/near/clubs",isReplaceUrl:!0,data:{lngx:$.$.currLngx||"",laty:$.$.currLaty||""},success:function(e){if(200==e.statusCode){e=e.respData||[];var t=h(e);0==t.length?($("#firstClubList").Class("nodata"),$(".first-page>div:nth-of-type(4)").Class("hide")):($("#firstClubList").Html(t.join("")),$(".first-page>div:nth-of-type(4)").ClassClear("hide")),o()}else $.tipShow(e.msg||"查询附近会所失败");$(".first-page>div:nth-of-type(1),.first-page>div:nth-of-type(2)").ClassClear("hide"),$(".first-page>div:nth-of-type(3)").Class("hide")}})}function o(){$("#content>div.show-area .club-item-list.has-techs>div:last-child>div").Each(function(e){var t=scrollHori({container:e,showEleCount:4});t&&oe.push(t)}),$(".club-item-list>div:first-child>div:nth-of-type(3):not(.has-event)").Click(function(e,t){e.stopPropagation(),C(t.dataset.clubId,"activities")}).Class("has-event"),$(".club-item-list>div:first-child:not(.has-event)").Click(function(e,t){e.stopPropagation(),C(t.dataset.clubId)}).Class("has-event"),$(".club-item-list>div:last-child>div>div:not(.has-event)").Click(function(e,t){e.stopPropagation(),C(t.dataset.clubId,"technicianDetail&id="+t.dataset.techId)}).Class("has-event")}function d(){$.ajax({url:"../api/v2/club/impression/list",isReplaceUrl:!0,data:{},success:function(e){200!=e.statusCode&&$.tipShow(e.msg||"查询印象标签数据出错");var t=[];e.respData.forEach(function(e){t.push("<div>"+e.tag+"</div>")}),$(".second-page>div:nth-of-type(2)>div:last-child>div").Html(t.join(""))}})}function c(){$.ajax({url:"../api/v2/club/tags",isReplaceUrl:!0,type:"post",data:{city:encodeURIComponent(Y||""),region:encodeURIComponent(q||""),laty:$.$.currLaty||0,lngx:$.$.currLngx||0},success:function(e){200==e.statusCode?e.respData&&Array.isArray(e.respData)&&$(".second-page>div:nth-of-type(1)>div:last-child>div").Html("<div>"+e.respData.join("</div><div>")+"</div>"):$.tipShow(e.msg||"查询会所标签数据出错")}})}function r(){$(".third-page").ClassClear("nodata"),$.ajax({url:"../api/v2/club/club_tech_search",isReplaceUrl:!0,type:"post",data:{laty:$.$.currLaty||"",lngx:$.$.currLngx||"",page:1,pageSize:3,search:encodeURIComponent(W),searchType:""},success:function(e){if(200==e.statusCode){e=e.respData;var t=[],a=[];t=h(e.clubs||[]),a=v(e.techs||[]),0==a.length&&0==t.length?$(".third-page").Class("nodata"):(t.length>0&&($(".third-page>div:nth-of-type(1)").ClassClear("hide"),$(".third-page>div:nth-of-type(1)>div:nth-of-type(2)").Html(t.join("")),o()),a.length>0&&($(".third-page>div:nth-of-type(2)").ClassClear("hide"),$(".third-page>div:nth-of-type(2)>div:nth-of-type(2)").Html(a.join(""))))}else $(".third-page").Class("nodata"),$.tipShow(e.msg||"");$(".third-page>div:nth-of-type(3)").Class("hide")}})}function p(e){e&&(B=0,ae=!1,Z.Html("")),B++,ee.ClassClear("hide"),te.Class("hide"),$.ajax({url:"../api/v2/club/club_tech_search",isReplaceUrl:!0,type:"post",data:{laty:$.$.currLaty||"",lngx:$.$.currLngx||"",page:B,pageSize:Q,search:encodeURIComponent(W),searchType:ie},success:function(e){if(200==e.statusCode){e=e.respData;var t=[],a=0;$(".fifth-page .has-event").ClassClear("has-event"),"club"==ie?(e.clubs||(e.clubs=[]),a=e.clubs.length,t=h(e.clubs)):(e.techs||(e.techs=[]),a=e.techs.length,t=v(e.techs||[])),0==t.length?1==B?($(".fifth-page").Class("nodata"),te.Class("hide")):(ae=!0,te.ClassClear("hide")):($(".fifth-page").ClassClear("nodata"),Z.Html(t.join(""),!0),a<Q&&(ae=!0,te.ClassClear("hide")),o())}else $(".fifth-page").Class("nodata"),$.tipShow(e.msg||"");ee.Class("hide")}})}function h(e){var t,a=[];return e.forEach(function(e,i){t=e.distance&&Number.MAX_VALUE!=e.distance?u(e.distance):"- m",e.distance=t,e.imageUrl&&0!=e.imageUrl.length||(e.imageUrl="img/logo_default.jpg"),a.push('<div class="club-item-list '+(e.techs&&e.techs.length>0?"has-techs":"no-techs")+'">                                        <div data-club-id="'+e.id+'">                                            <div style="background-image: url('+(e.imageUrl||$.$.defaultClubLogo)+')"></div>                                            <div>'+e.name+"</div>                                            <div "+(e.couponCount>0?"":'class="hide"')+' data-club-id="'+e.id+'">优惠</div>                                            <div>'+t+"</span></div>                                        </div><div>                                        "+(e.techs&&e.techs.length>0?"                                            <div>                                            "+function(t){var a=[];return t.forEach(function(t){a.push('<div data-club-id="'+e.id+'" data-tech-id="'+t.id+'">                                                                        <div style="background-image: url('+(t.avatarUrl||$.$.defaultHeader)+')"></div>                                                                        <div><div>'+t.name+"</div><div>"+(t.visitCount?t.visitCount>=1e3?(t.visitCount/1e3).toFixed(1)+"K":t.visitCount:0)+"</div>                                                                        </div>                                                                    </div>")}),a.join("")}(e.techs)+"</div>":"")+"                                    </div></div>")}),a}function v(e){var t=[];return e.forEach(function(e){t.push('<div class="tech-item">                                        <div data-club-id="'+e.id+'"><div><div style="background-image:url('+(e.imageUrl||$.$.defaultClubLogo)+')"></div></div>                                            <div>                                                <div>'+e.name.replace(new RegExp(W,"g"),'<span class="key-words">'+W+"</span>")+"</div>                                            </div>                                            <div>"+u(e.distance)+"</div>                                        </div>                                        <div>"+function(e){var t=[];return e.forEach(function(e){t.push('<div data-club-id="'+e.clubId+'" data-tech-id="'+e.techId+'">                                                                                                <div><div style="background-image: url('+(e.avatarUrl||$.$.defaultHeader)+')"></div></div>                                                                                                <div>                                                                                                    <div><div>'+(e.name||$.$.defaultTechName).replace(new RegExp(W,"g"),'<span class="key-words">'+W+"</span>")+'</div><div><span>                                                                                                            <span><span style="width:'+e.star+'%"></span></span>'+e.commentCount+" 评论</span>                                                                                                    </div></div>                                                                                                    <div><span>"+e.tag.replace(new RegExp(W,"g"),'<span class="key-words">'+W+"</span>").replace(/,/g,"，</span><span>")+"</span></div>                                                                                                </div>                                                                                            </div>")}),t.join("")}(e.techImpression)+"                                        </div>                                    </div>")}),t}function u(e){return e=1e3*parseFloat(e,10),isNaN(e)||1e9==e?"- m":e>1e3?(e/1e3).toFixed(1)+"km":e.toFixed(0)+" m"}function f(){return ne=Date.now().toString(36),pe={initShowPageIndex:J,showPageIndex:G,scrollTop:$("#content")[0].scrollTop,searchType5:ie,searchText:N.Value(),data:$("#content").Html()},se.push(ne),$.localStorage("9358_club_list_cache_list",JSON.stringify(se)),$.localStorage(ne,JSON.stringify(pe)),$.paramClear("clubListReadCache"),$.param("clubListReadCache",ne),ne}function C(e,t){t=t||"home",location.href=fe+e+"#"+t+("9358"==$.$.visitChannel?"&clubsource=9358":"")+"&clubListReadCache="+f()}var g,y=[],m=1,b=20,w=0,I="distance",S="all",x=$("#content"),L=$("#filterMenu"),k=$("#filterMenu>div:not(:nth-of-type(4))>div"),T=$("#clubFilterPop"),D=$("#content div.fourth-page>div.list"),M=$("#content div.fourth-page>div:nth-of-type(2)"),U=$("#content div.fourth-page>div:nth-of-type(2)>span"),A=$("#content div.fourth-page>div:nth-of-type(2)>img"),P=$("#content div.fourth-page>div:nth-of-type(3)"),_=!1,R=!1,E=$("div#content>div:nth-of-type(1)>div:nth-of-type(1)>div:last-child"),H=$("#filterMenu>div:nth-of-type(4)"),j=$("#searchArea>div:nth-of-type(3)"),N=$("#searchArea input"),O=$("#searchArea"),F=$("#searchArea>div:nth-of-type(2)"),V=$.param("code")||$.getUrlParam("code"),z=!0,J=$.param("showPageIndex")||$.getUrlParam("showPageIndex")||4,G=$.param("showPageIndex")||$.getUrlParam("showPageIndex")||J,X=$(".show-area"),K=!0,W="",Y="",q="",B=1,Q=10,Z=$("#content div.fifth-page>div.list"),ee=$("#content div.fifth-page>div:nth-of-type(2)"),te=$("#content div.fifth-page>div:nth-of-type(3)"),ae=!1,ie="club",se=JSON.parse($.localStorage("9358_club_list_cache_list")||"[]")||[],ne=$.getUrlParam("clubListReadCache")||!1,le=null,oe=[],de=1;if($.$.ua.isWX&&(!$.$.openId||$.$.openId.length<10)){if(!V)return void $.getOauthCode("","9358","9358","base");$.ajax({url:($.$.clubID?"../":"")+"../wx/oauth2/openid",data:{code:V,scope:"snsapi_base",sessionType:"9358",openId:$.$.payOpenId||"",webSessionId:$.$.paySessionId||""},success:function(e){if(200==e.statusCode)$.$.openId=e.respData.openid,$.$.payOpenId=e.respData.openid,$.$.paySessionId=e.respData.sessionId,$.localStorage("openId",$.$.openId),$.localStorage("payOpenId",$.$.payOpenId),$.localStorage("paySessionId",$.$.paySessionId),s(),$.pageSwitch();else{if("40029"!=e.statusCode)return $.tipShow(e.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","9358","base")}}})}else s(),$.pageSwitch();if($.$.currLngx&&$.$.currLaty)if(AMap&&AMap.LngLat)t();else var ce=0,re=setInterval(function(){ce++,AMap&&AMap.LngLat?(clearInterval(re),t()):ce>30&&(clearInterval(re),$.tipShow("高德地图初始化失败！"))},150);else $.tipShow("请打开“9358”公众号的位置信息");var pe="",he=!1,ve=1,ue=!1,$e=!1,fe=location.origin+location.pathname+"?club="}();