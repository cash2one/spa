!function(){function t(){$.ajax({url:"../api/v2/club/one_yuan/view",isReplaceUrl:!0,data:{clubId:$.$.clubID,oneYuanId:j,oneYuanBaseId:N},success:function(e){if(200==e.statusCode){var o=e.respData.lastOneYuanDrawLog,i=e.respData.myTicketNos.split(","),d=e.respData.oneYuanAct,r=e.respData.oneYuanDrawLog;if(I=e.respData.canPaidCount,P.Text(I),j=d.id,j&&!H&&(H=!0,n()),$.ajax({url:"../api/v2/club/one_yuan/share/url",isReplaceUrl:!0,data:{oneYuanId:j},success:function(e){200==e.statusCode&&(u=e.respData,R++,2==R&&s())}}),N=d.oneYuanBaseId,$("#past-win-info>div:nth-of-type(1)").Page("oneYuanPastWinRecords&oneYuanBaseId="+N),$("#oneYuan-header>img")[0].src=d.imageUrl||"./img/oneYuan/bg-image.jpg",_=d.imageUrl||"./img/oneYuan/bg-image.jpg",R++,2==R&&s(),$("#content>div:nth-of-type(1)").Class("act-"+d.status),$("#act-processing>div:nth-of-type(1)>div:nth-of-type(2)").Html(d.actName+"<span>(第"+d.currentPeriod+"期)</span>"),$("#showNumsPop>div>div:nth-of-type(1)>div:nth-of-type(1)").Text(d.actName),$("#act-processing>div:nth-of-type(1)>div:nth-of-type(3)>span:nth-of-type(1),#act-processing>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>span:nth-of-type(1)").Html("<span>￥</span>"+d.actPrice),$("#act-processing>div:nth-of-type(1)>div:nth-of-type(3)>span:nth-of-type(2),#act-processing>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>span:nth-of-type(2)").Text(d.duration),$("#act-processing>div:nth-of-type(2)>div:nth-of-type(2)>div").CSS("width",d.paidCount/d.totalPaidCount*100+"%"),$("#act-processing>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(2)>span").Text(I),$("#join-info>div>div:nth-of-type(1)>div:nth-of-type(1)>span").Text("("+d.unitPrice+"元参与一次)"),"end"===d.status){$("#act-processing>div:nth-of-type(1)>div:nth-of-type(1)").Text("待开奖");var l,f,h,v,y,C,x,w=new Date(d.completeTime),T=["00","时","00","分"],D=$("#act-calc-time>div:nth-of-type(1)>div:nth-of-type(3)"),U=$("#act-calc-time>div:nth-of-type(1)>div:nth-of-type(4)"),O=$("#act-calc-time>div:nth-of-type(1)>div:nth-of-type(5)"),E=$("#act-calc-time>div:nth-of-type(1)>div:nth-of-type(6)"),M=function(){D.Text(T[0]),U.Text(T[1]),O.Text(T[2]),E.Text(T[3])},B=$.localStorage("spa_one_yuan_detail")?JSON.parse($.localStorage("spa_one_yuan_detail")):{};if(l=B[j]||0,l&&new Date-l<6e5)$.tipShow("暂未开奖，稍后重新查询"),f=new Date(l-0);else{var J=new Date;w-new Date($.commonDateFormat(J,"yyyy/MM/dd 20:30:00"))>0&&J.setDate(J.getDate()+1),f=new Date($.commonDateFormat(J,"yyyy/MM/dd 21:00:00"))}h=function(){var e=new Date;if(f-e>0){var n=(f-e)/1e3;v=~~(n/3600%24),y=~~(n/60%60),C=~~(n%60),v>0?(T=[v<10?"0"+v:v,"时",y<10?"0"+y:y,"分"],x=1e3*(C+1)):(T=[y<10?"0"+y:y,"分",C<10?"0"+C:C,"秒"],x=1e3),setTimeout(h,x)}else{l=new Date,l.setMinutes(l.getMinutes()+10);var a={};a[j]=l-0,$.localStorage("spa_one_yuan_detail",JSON.stringify(a)),t()}M()},h(),$("#act-calc-time>div:nth-of-type(2)").Text("将以"+(f.getFullYear()+"年"+(f.getMonth()+1)+"月"+f.getDate()+"日")+"福彩3D开奖结果为准"),$("#oneYuan-footer").Hide()}else"complete"===d.status&&r?($("#act-processing>div:nth-of-type(1)>div:nth-of-type(1)").Text("已揭晓"),$("#winner-info>div>div:nth-of-type(1)>div:nth-of-type(1)").CSS("background-image","url("+(r.userAvatarUrl||$.$.defaultHeader)+")"),$("#winner-info>div>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(2)").Text(r.userName),$("#winner-info>div>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>span").Text(r.ticketCount),$("#winner-info>div>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)>div:nth-of-type(2)").Text(d.drawTime),$("#winner-info>div>div:nth-of-type(2)>div:nth-of-type(2)").Text(r.actDrawNo),$("#winner-info>div>div:nth-of-type(2)>div:nth-of-type(3)").Attr("data-user-id",r.userId).Click(function(e,t){e.stopImmediatePropagation(),p?a():$.ajax({url:"../api/v2/club/one_yuan/user/ticket_no",isReplaceUrl:!0,data:{userId:t.dataset.userId,oneYuanId:j},success:function(e){200==e.statusCode?(p=e.respData.split(","),a()):$.tipShow(resutl.msg||"查询中奖者号码失败")}})}),e.respData.onlinePeriod?($("#oneYuan-footer").Class("oneYuan-over"),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(1)").Text("第"+e.respData.onlinePeriod+"期正在火热进行中..."),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(2)").Click(function(){$.page("oneYuanDetail&oneYuanId="+e.respData.onlineOneYuanId,1,!0)})):$("#oneYuan-footer").Hide()):"refund"===d.status?($("#act-processing>div:nth-of-type(1)>div:nth-of-type(1)").Text("已退款"),e.respData.onlinePeriod?($("#oneYuan-footer").Class("oneYuan-over"),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(1)").Text("第"+e.respData.onlinePeriod+"期正在火热进行中..."),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(2)").Click(function(){$.page("oneYuanDetail&oneYuanId="+e.respData.onlineOneYuanId,1,!0)})):$("#oneYuan-footer").Hide()):"not_online"===d.status&&($("#act-processing>div:nth-of-type(1)>div:nth-of-type(1)").Text("已下线"),e.respData.onlinePeriod?($("#oneYuan-footer").Class("oneYuan-over"),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(1)").Text("第"+e.respData.onlinePeriod+"期正在火热进行中..."),$("#oneYuan-footer>div:nth-of-type(2)>div:nth-of-type(2)").Click(function(){$.page("oneYuanDetail&oneYuanId="+e.respData.onlineOneYuanId,1,!0)})):$("#oneYuan-footer").Hide());i.length>0&&i[0]?($("#my-nums>div:nth-of-type(1)>div:nth-of-type(2)").Text(i.slice(0,7).join(" ")),i.length>7?(c.ClassClear("no-more"),$("#my-nums>div:nth-of-type(2)>div:nth-of-type(1)").Text(i.join(" "))):c.Class("no-more")):(c.Class("null-data"),$("#my-nums>div:nth-of-type(1)>div:nth-of-type(2)").Text("您暂未购买")),o&&($("#past-win-info>div:nth-of-type(2)>div").CSS("background-image","url("+(o.userAvatarUrl||$.$.defaultHeader)+")"),$("#past-win-info>div:nth-of-type(3)").Text(o.userName+o.phoneNum.replace(/^(\d{3})\d{4}(\d{4})$/g,"（$1****$2）")),$("#past-win-info").ClassClear("hide")),$("div#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)").Html(d.actDescription||"无"),$("div#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").CSS("background-image","url("+(d.prizeImageUrl||$.$.defaultService)+")"),$("div#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(d.actName),$("div#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").Text(d.actPrice+"元/"+d.duration),$("div#itemExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)").Html(d.prizeDescription||"无");var A=!1;b.Click(function(e,t){function n(){$.ajax({url:"../api/v2/wx/pay/paid_one_yuan",isReplaceUrl:!0,type:"post",data:{count:S.Text(),chanel:$.getUrlParam("chanel",!0)||"link",clubId:$.$.clubID,oneYuanId:j,openId:$.$.openId,phoneNum:m.Value(),shareCode:$.getUrlParam("shareCode",!0)||"",topShareCode:$.getUrlParam("topShareCode",!0)||"",tradeChannel:"wx",businessChannel:$.getUrlParam("chanel",!0)||"link"},success:function(e){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp+"",nonceStr:a.nonceStr,"package":a["package"],signType:a.signType,paySign:a.paySign},function(e){A=!1,e.err_msg&&e.err_msg.indexOf("ok")>=0?($.localStorage("tmpOneYuanNums_cache",JSON.stringify({nums:n.ticketNo,shareUrl:u,shareImage:_,oneYuanId:j})),$.tipShow("购买成功"),$.eventMaskShow(!1),S.Text(1),Y.ClassClear("checked"),$.page("oneYuanSuccess&oneYuanId="+j)):(A=!1,$.eventMaskShow(!1),$.tipShow("未能成功支付！"),$.ajax({url:"../api/v2/club/one_yuan/pay_failure",type:"post",isReplaceUrl:!0,data:{oneYuanOrderId:n.id},success:function(e){}}))})}if(200==e.statusCode){e=e.respData;var n=e.oneYuanOrderLog;n.amount<S.Text()&&(I=n.amount,$(".timesSurplus,#act-processing>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(2)>span").Text(I),$("#act-processing>div:nth-of-type(2)>div:nth-of-type(2)>div").CSS("width","100%"),S.Text(0==I?1:I),$.tipShow("剩余次数小于您所选购的次数，请注意！"));var a=JSON.parse(e.tradeReqData);"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t()}else"935801"==e.statusCode?(A=!1,$.eventMaskShow(!1),$.tipShow("OpenId无效，重新授权"),$.getOauthCode("","9358","paid-oneYuan","base")):500==e.statusCode&&(A=!1,$.eventMaskShow(!1),$.tipShow("此次未购买成功。"))}})}if(!b.ClassHave("disabled")){if(A)return $.tipShow("支付购买中...");A=!0,$.eventMaskShow(!0),k?($.tipShow("支付购买中..."),n()):($.tipShow("绑定手机中..."),$.execBindPhone(m.Value(),g.Value(),function(e){200!=e.statusCode?($.eventMaskShow(!1),$.tipShow(e.msg||"绑定失败，请重新绑定。")):($.tipShow("绑定成功，支付购买中..."),n())},!1))}})}else $.tipShow(e.msg||"查询数据失败")}})}function n(){$.ajax({url:"../api/v2/club/one_yuan/paid/records",isReplaceUrl:!0,data:{clubId:$.$.clubID,oneYuanId:j,page:1,pageSize:3},success:function(e){if(200==e.statusCode){var t=[];e=e.respData;for(var n=0,a=e.length;n<a;n++)t.push('<div class="join-item">                        <div style="background-image: url('+(e[n].userAvatarUrl||$.$.defaultHeader)+')"></div>                        <div>                            <div>                                <div>'+(e[n].userName+e[n].phoneNum.replace(/^(\d{3})\d{4}(\d{4})$/g,"（$1****$2）"))+"</div>                                <div><span>"+e[n].ticketCount+"</span>人次</div>                            </div>                            <div>"+e[n].createdTime+"</div>                        </div>                    </div>");t.length>0&&($("#join-list>div:nth-of-type(2)>div:nth-of-type(1)").Html(t.join("")),$("#join-list>div:nth-of-type(2)").ClassClear("null-data"),$("#join-list>div:nth-of-type(1)>div:nth-of-type(3),#join-list>div:nth-of-type(1)>div:nth-of-type(4)").ClassClear("hide"),$("#join-list>div:nth-of-type(1)").Page("oneYuanJoinRecords&oneYuanId="+j))}else $.tipShow(e.msg||"查询参与记录失败")}})}function a(){$("#showNumsPop>div>div:nth-of-type(2)>div:nth-of-type(1)>span").Text(p.length),$("#showNumsPop>div>div:nth-of-type(2)>div:nth-of-type(2)").Text(p.join(" ")),h.Class("active")}function o(){D[0]&(D[1]|Number(k))?b.ClassClear("disabled"):b.Class("disabled")}function i(){clearTimeout(O),O=0,B=0,M=200}function d(){return E<0&&1==S.Text()||E>0&&S.Text()==I?void i():(w&&(w=!1,Y.ClassClear("checked")),B++,M=M>10?M-=5:M,S.Text(parseInt(S.Text())+E),void(O=setTimeout(d,M)))}function s(){u||(u=$.param("chanel")?location.href:location.href+"&chanel=link"),$.$.ua.isWX?($.X5Config({title:"谁替我买单",desc:"我和你只有一块钱的距离,点我立即参与",link:u,imgUrl:_,success:function(){f.ClassClear("active")},cancel:function(){},fail:function(e){$.tipShow("分享失败！请刷新页面后再试！"),$.ajax({url:"../api/v2/user/share/info",isReplaceUrl:!0,type:"post",token:"null",data:{url:encodeURIComponent(location.href),browser:encodeURIComponent($.$.ua.value),message:encodeURIComponent(JSON.stringify(e||{}))},error:function(){}})}}),$("#share-coupons-pop>div:nth-of-type(1)").Show()):($("#share-coupons-pop>div:nth-of-type(2)>div:nth-of-type(1)>a").Text(u),$("#share-coupons-pop>div:nth-of-type(2)").Show())}var p,u,r=$("#oneYuan-footer .robed"),l=$("#oneYuan-footer .shared"),c=$("#my-nums"),f=$("#share-coupons-pop"),h=$("#showNumsPop"),v=$("#showNumsPop>div>div:nth-of-type(1)>div:nth-of-type(2)"),y=$("#join-info"),m=$(".phone-item>div:nth-of-type(2)>input"),g=$(".code-item>div:nth-of-type(2)>input"),C=$(".phone-item>div:nth-of-type(3)"),x=60,S=$("#join-info .times-count"),Y=$("#join-info>div>div:nth-of-type(2)>.input-item.amount-item>div:nth-of-type(3)"),w=!1,T=$("#join-info .close-btn"),b=$("#join-info div.sure-btn"),D=[0,0],k=!!$.$.userTel,I=0,P=$("#join-info .timesSurplus"),j=$.getUrlParam("oneYuanId",!0),N=$.getUrlParam("oneYuanBaseId",!0),U=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,_="./img/oneYuan/bg-image.jpg",R=0,H=!1;if(!j&&!N)return $.tipShow("缺少活动ID"),$.pageCancel();U&&"paid-oneYuan"==$.getUrlParam("state")?$.ajax({url:($.$.clubID?"../":"")+"../wx/oauth2/user/openid",type:"post",data:{code:U,scope:"snsapi_base",wxmp:"9358",userType:"user",state:"paid-oneYuan"},success:function(e){if(200==e.statusCode)$.$.openId=resp.respData.openid,t();else{if("935801"!=e.statusCode)return $.tipShow(e.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","paid-oneYuan","base")}}}):t(),k&&($("#join-info>div>div:nth-of-type(2)").Class("is-bind"),m.Value($.$.userTel).Attr("disabled","disabled"),b.ClassClear("disabled")),j&&!H&&(H=!0,n()),$.pageSwitch(!1),$("#oneYuan-header>.club-info>div:nth-of-type(1)").CSS("background-image","url("+($.$.clubLogo||$.$.defaultClubLogo)+")"),$("#oneYuan-header>.club-info>div:nth-of-type(2)").Text($.$.clubName||$.$.defaultClubName),$("#oneYuan-header>.club-info").Page("home",-1,!0),$("#oneYuan-header>div.act-rule").Page("oneYuanExplain"),v.Click(function(){h.ClassClear("active")}),c.Delegate("click",">div:nth-of-type(1)",function(e,t){c.ClassHave("no-more")||(c.ClassHave("expanded")?c.ClassClear("expanded"):c.Class("expanded"))}).Delegate("click",">div:nth-of-type(2)>div:nth-of-type(2)",function(e,t){c.ClassClear("expanded")}),r.Click(function(e,t){return $.$.ua.isWX?$.$.userToken?void y.Class("active"):($.$.loginUrl="oneYuanDetail&oneYuanId="+j,$.page("login"),$.tipShow("请先登录")):$.tipShow("请在微信浏览器中打开")}),l.Click(function(){f.Class("active")}),$("#share-coupons-pop>div:nth-of-type(2)>div:nth-of-type(3)").Click(function(){f.ClassClear("active")}),f.Click(function(){f.ClassClear("active")}),$("#share-coupons-pop>div:nth-of-type(2)").Click(function(e){e.stopPropagation()}),$("#share-coupons-pop>div:nth-of-type(1)").Click(function(e){e.stopPropagation()}),T.Click(function(e,t){y.ClassClear("active")}),m.Verify("tel",function(e){D[0]=Number(e),D[0]?C.ClassClear("disabled"):C.Class("disabled"),o()}),g.Verify("authcode",function(e){D[1]=Number(e),o()}),C.Click(function(e,t){C.ClassHave("disabled")||x<60||(C.Class("disabled").Text("重发（60s）"),m.Attr("disabled","disabled"),$.ajax({url:"../api/v1/icode",isReplaceUrl:!0,type:"get",data:{mobile:m.Value()}}),setTimeout(function n(){x--,x>0?(C.Text("重发（"+x+"s）"),setTimeout(n,1e3)):(x=60,C.Text("发送验证码"),m.AttrRemove("disabled"),D[0]&&C.ClassClear("disabled"))},1e3))});var O=0,E=1,M=200,B=0;$("#join-info .reduce-count,#join-info .plus-count").Event("touchstart",function(e,t){e.preventDefault(),i(),E="plus"==t.dataset.type?1:-1,d()}).Event("touchmove",function(e,t){}).Event("touchend",function(e,t){e.preventDefault(),i()}).Event("touchcancel",function(){e.preventDefault(),i()}),Y.Click(function(e,t){w?(Y.ClassClear("checked"),S.Text(1)):(Y.Class("checked"),S.Text(I)),w=!w})}();