!function(){var t=$.param("userActId"),e=$.param("couponType"),n="paid_service_item"===e||"service_item"===e;if(!t)return $.tipShow("地址栏缺少参数！"),$.pageCancel();"true"==$.param("backPublic")&&$("#title>div:nth-of-type(2)").Click(function(t){t.stopImmediatePropagation(),history.back()});var o="../api/v2/club/userredpacket/"+t;n&&(o="../api/v2/club/user/service_item_coupon/view"),$.ajax({url:o,isReplaceUrl:!0,data:{userType:"user",id:t,suaId:t},success:function(o){function i(){var t=new QRCode($("#couponQrCode")[0],{width:430,height:430});t.makeCode(o.userAct.couponNo),y.src=$("#couponQrCode>canvas")[0].toDataURL(),$(y).Class("native")}if(200!=o.statusCode)return $.tipShow(o.msg||"数据请求失败！"),$.pageCancel();o=o.respData;var p=!0;if(n){$("#content>div:nth-of-type(3)>div:nth-of-type(3),#content>div:nth-of-type(3)>div:nth-of-type(4),#content>div:nth-of-type(3)>div:nth-of-type(5),#content>div:nth-of-type(3)>div:nth-of-type(6)").Class("hide"),$("#content>div:nth-of-type(4),#content>div:nth-of-type(6),#content>div:nth-of-type(7),#content>div:nth-of-type(8)").Class("hide"),$("#content>div:nth-of-type(3)>div:nth-of-type(7),#content>div:nth-of-type(3)>div:nth-of-type(8),#content>div:nth-of-type(3)>div:nth-of-type(9),#content>div:nth-of-type(3)>div:nth-of-type(10)").ClassClear("hide"),$(".rob-item").ClassClear("hide"),$("#content>div:nth-of-type(3)>div:nth-of-type(1)").Text(o.userAct.couponTypeName),$("#content>div:nth-of-type(3)>div:nth-of-type(2)").Text(o.userAct.actTitle),"credits"==o.userAct.paidType?$("#content>div:nth-of-type(3)>div:nth-of-type(7)>span").Text(o.userAct.actValue+" 积分"):"give"==o.userAct.paidType?$("#content>div:nth-of-type(3)>div:nth-of-type(7)").Html("卡券来源：<span>奖品赠送</span>"):$("#content>div:nth-of-type(3)>div:nth-of-type(7)>span").Text(o.userAct.actValue+" 元"),$("#content>div:nth-of-type(3)>div:nth-of-type(8)>span").Text(o.userAct.couponPeriod),$("#content>div:nth-of-type(3)>div:nth-of-type(9)>span").Text(o.userAct.getDate),o.userAct.techId&&($("#content>div:nth-of-type(3)>div:nth-of-type(11)").ClassClear("hide"),$("#content>div:nth-of-type(3)>div:nth-of-type(11)>span").Text(o.userAct.techName));var c=new Date(o.userAct.useEndDate.split(" ")[0].replace(/-/g,"/")+" 23:59:59").getTime()-(new Date).getTime();c=Math.floor(c/864e5)>0?"<span>"+Math.floor(c/864e5)+"</span> 天":Math.floor(c/36e5)>0?"<span>"+Math.floor(c/36e5)+"</span> 小时":"<span>"+Math.floor(c/6e4)+"</span> 分",$("#content>div:nth-of-type(3)>div:nth-of-type(10)").Html("剩余 "+c),"settled"==o.userAct.status?($("#content>div:nth-of-type(3)>div:nth-of-type(10)").Text("已使用"),$("#content>div:nth-of-type(5)").CSS("display","none")):"","paid_service_item"===e?($("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)>span").Text(o.userAct.useStartDate.split(" ")[0]+" - "+o.userAct.useEndDate.split(" ")[0]),o.userAct.useDay?(7==o.userAct.useDay.match(/(\d)/g).length&&(o.userAct.useDay="170"),$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>span").Text((o.userAct.useDay||"").replace(/(\d)/g,function(){return["周日","周一","周二","周三","周四","周五","周六"," 至 "][arguments[1]]})+" "+(o.userAct.startTime?o.userAct.startTime.replace(/:00$/g,"")+":00 - "+o.userAct.endTime.replace(/:00$/g,"")+":00":""))):o.userAct.usePeriod?$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>span").Text(o.userAct.usePeriod):$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").CSS("display","none"),$("#actExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(3)").Html(o.userAct.actContent)):($("#actExplain").Class("hide"),$("#projectCouponExplain").ClassClear("hide"),$("#projectName").Text(o.userAct.actTitle),$("#projectCouponExplain>div:nth-of-type(2)>div:nth-of-type(2)>div").Html(decodeURIComponent(o.userAct.actContent))),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").CSS("background-image","url("+(o.userAct.imageUrl||$.$.defaultService)+")"),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(o.userAct.actTitle),"service_item"===e&&("paid_service_item"!==o.userAct.useType?($("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").Text("网店价："+o.userAct.actValue+"元/"+o.userAct.duration+o.userAct.durationUnit),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)>span:nth-of-type(1)").Text(o.userAct.price+"元/"+o.userAct.duration+o.userAct.durationUnit),o.userAct.pricePlus&&$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)>span:nth-of-type(2)").Text(o.userAct.pricePlus+"元/"+o.userAct.durationPlus+o.userAct.durationUnitPlus)):$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(3)").Html("<span>"+o.userAct.price+"元/"+o.userAct.duration+o.userAct.durationUnit+"</span>"+(o.userAct.pricePlus?"<span>"+o.userAct.pricePlus+"元/"+o.userAct.durationPlus+o.userAct.durationUnitPlus+"</span>":""))),$("#projectExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)").Html(o.userAct.description||"无")}else{var s="money"==o.userAct.useType,a="redpack"==o.userAct.couponType;if($("#content>div:nth-of-type(3)>div:nth-of-type(1)").Text(o.userAct.useTypeName),$("#content>div:nth-of-type(3)>div:nth-of-type(2)").Text(s?o.userAct.actValue+"元":o.userAct.actTitle),s&&0==o.userAct.consumeMoney?$("#content>div:nth-of-type(3)>div:nth-of-type(3)").CSS("display","none"):$("#content>div:nth-of-type(3)>div:nth-of-type(3)").Text(o.userAct.consumeMoneyDescription),$("#content>div:nth-of-type(3)>div:nth-of-type(4)>span").Text(o.userAct.couponPeriod),$("#content>div:nth-of-type(3)>div:nth-of-type(5)>span").Text(o.userAct.getDate),a?$("#content>div:nth-of-type(3)>div:nth-of-type(6)>span").Text(o.userAct.canUseSum+"次"):($("#content>div:nth-of-type(3)>div:nth-of-type(6)").CSS("display","none"),$("#content>div:nth-of-type(4)").CSS("display","none"),$("#content>div:nth-of-type(6)").CSS("display","none")),s||!o.userAct.actDescription?$("#content>div:nth-of-type(7)").CSS("display","none"):(o.userAct.actDescription&&0!=o.userAct.actDescription.length||(o.userAct.actDescription="无"),$("#content>div:nth-of-type(7)>div:nth-of-type(2)").Html(o.userAct.actDescription)),o.phoneNums_get&&o.phoneNums_get.length>0||o.phoneNums_use&&o.phoneNums_use.length>0){var r,u="",d=s?o.userAct.actValue+"元"+o.userAct.useTypeName:o.userAct.actTitle;if(o.phoneNums_get)for(r=0;r<o.phoneNums_get.length;r++)u+="<li>"+o.phoneNums_get[r].phone+"<div>已经领取"+d+"<span>"+o.phoneNums_get[r].date+"</span></div></li>";if(o.phoneNums_use)for(r=0;r<o.phoneNums_use.length;r++)u+="<li>"+o.phoneNums_use[r].phone+"<div>已经使用"+d+"<span>"+o.phoneNums_use[r].date+"</span></div></li>";$("#content>div:nth-of-type(6)>ul").Html(u)}else $("#content>div:nth-of-type(6)").CSS("display","none");o.userAct.actContent&&0!=o.userAct.actContent.length||(o.userAct.actContent="无"),$("#content>div:nth-of-type(8)>div:nth-of-type(2)").Text("券有效期："+o.userAct.couponPeriod),$("#content>div:nth-of-type(8)>div:nth-of-type(3)").Text("使用时段："+o.userAct.useTimePeriod),$("#content>div:nth-of-type(8)>div:nth-of-type(4)").Html("<div></div>"+o.userAct.actContent);var h=[];o.items=o.items||[];for(var r=0;r<o.items.length;r++)h.push(o.items[r].name);h.length>0&&$("#content>div:nth-of-type(8)>div:nth-of-type(4)>div").Html("使用项目：仅限"+h.join("，"));var v=$("#content>div:nth-of-type(4)>div");if(("1"!=o.userAct.couponStatus&&"2"!=o.userAct.couponStatus||!o.shareUrl)&&v.Class("unwork"),p=!($.$.ua.isWX&&!v.ClassHave("unwork")),a){var f=$("#show-coupons-pop");$("#show-coupons-pop>div:nth-of-type(2)>div:nth-of-type(3)").Click(function(){f.ClassClear("active")}),f.Click(function(){f.ClassClear("active")}),$("#show-coupons-pop>div:nth-of-type(2)").Click(function(t){t.stopPropagation()}),$("#show-coupons-pop>div:nth-of-type(1)").Click(function(t){t.stopPropagation()}),$("#show-coupons-pop>div:nth-of-type(2)>div:nth-of-type(1)").Html("<a href='"+o.shareUrl+"'>"+o.shareUrl+"</a>"),$.$.ua.isWX?$("#show-coupons-pop>div:nth-of-type(1)").CSS("display","block"):$("#show-coupons-pop>div:nth-of-type(2)").CSS("display","block"),v.ClassHave("unwork")?v.Click(function(){$.tipShow("活动已过期！不可分享！")}):v.Click(function(){f.Class("active")})}p||$.X5Config({title:o.clubName+"-"+(s?o.userAct.actValue+"元"+o.userAct.useTypeName:o.userAct.actTitle),desc:a?"此券可在"+o.clubName+"使用，分享给朋友获得更多优惠。":"送你一张优惠券，带上它，让你的身体爽一把。",link:o.shareUrl,imgUrl:o.imageUrl,success:function(){f.ClassClear("act"),$.ajax({url:($.$.clubID?"../":"")+"/redpacket/share",data:{userActId:t},success:function(t){"200"==t.statusCode&&f.ClassClear("active")}})},cancel:function(){},fail:function(t){$.tipShow("分享失败！请稍后再试！")}})}$("#content>div:nth-of-type(2)").Text(o.clubName);var y=$("#content>div:nth-of-type(5)>img")[0];y.onload=function(){y.style.opacity="1"};var l="../api/v2/club/user/coupon_qrcode";n&&(l="../api/v2/club/user_paid_service_item/qrcode"),o.userAct.couponQrCodeUrl||o.userAct.qrCodeUrl?y.src=o.userAct.couponQrCodeUrl||o.userAct.qrCodeUrl:i(),$("#content>div:nth-of-type(5)>span").Text(o.userAct.couponNo.substr(0,4)+" "+o.userAct.couponNo.substr(4,4)+" "+o.userAct.couponNo.substr(8)),$.pageSwitch(p)}})}();