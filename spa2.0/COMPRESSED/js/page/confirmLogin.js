!function(){function e(){l[0]&&l[1]?n.Class("active"):n.ClassClear("active"),l[0]?i.CSS("display","none"):i.CSS("display","block")}function o(){if(n.ClassHave("active")){var e={username:s.Value(),password:r.Value(),usertype:"user",clubId:$.$.clubID||$.$.loginChannelClubID||"",code:c,isBindWeixin:t?"Y":"N"};"9358"==$.$.sessionType&&(e.loginChanel=$.$.loginChanel,e.openId=$.$.openId,e.wxNickName=$.$.nickName==$.$.defaultUserName?"":$.$.nickName,e.wxHeadimgurl=$.$.headerImgUrl==$.$.defaultHeader?"":$.$.headerImgUrl),$.ajax({url:"../api/v1/user/login",isReplaceUrl:!0,type:"post",data:e,success:function(o){if(2==o.statusCode)e.isHidePassword=change[0].checked,window.loginInfo=e,$.page("register");else if("935801"==o.statusCode)$.localStorage("con-login-param",JSON.stringify(e)),$.getOauthCode("","9358","9358_login","base");else if(200==o.status){$.$.userToken=o.token,$.$.userID=o.userId,$.$.userHeader=o.avatarUrl||"img/header_default.jpg",$.$.userTel=o.phoneNum,$.$.userName=o.name,$.$.userLoginName=o.loginName,$.cookie("userToken",$.$.userToken,30),$.cookie("userID",$.$.userID,30),$.cookie("userHeader",$.$.userHeader,30),$.cookie("userTel",$.$.userTel,30),$.cookie("userName",$.$.userName,30),$.cookie("userLoginName",$.$.userLoginName,30),$.localStorage("userToken",$.$.userToken),$.localStorage("web"==$.$.sessionType?"userToken_web":"userToken_9358",$.$.userToken),$.localStorage("userID",$.$.userID),$.localStorage("userHeader",$.$.userHeader),$.localStorage("userTel",$.$.userTel),$.localStorage("userName",$.$.userName),$.localStorage("userLoginName",$.$.userLoginName),$.$.is_telphone_user=!0,$.localStorage("is_telphone_user",!0),$.cookie("is_telphone_user",!0);var s=$.$.easemob;s.userId=o.emchatId,$.localStorage("easemobUserId",s.userId),u.oldUserId&&u.oldUserId!=$.$.userID&&($.localStorage("easemobSecondUserId",u.oldChatId),s.secondUserId=u.oldChatId,$.switchUserChatInfo(u.oldUserId,$.$.userID)),a(),o.message&&$.tipShow(o.message)}else"HAS_BOUND"==o.respData?($.tipShow(o.message||"当前用户已绑定"),$.page($.$.loginUrl,-1,!0)):$.tipShow(o.message)}})}}function a(){var e=$.$.easemob,o=!1;e.conn.isClosed()||(o=!0,e.conn.stopHeartBeat(e.conn),e.conn.close(),e.currChatTech={},e.sessionList=null,e.msgList={}),setTimeout(function(){e.conn.open({user:e.userId,pwd:e.userId,appKey:e.appKey}),e.secondUserId&&$.createEasemobConn(1);var o=$.sessionStorage("login_luckyWheel");if(o){if($.$.userTel)return void(location.href=location.origin+"/spa-manager/luckyWheel?actId="+o+"&clubId="+$.$.clubID);$.tipShow("请您先绑定手机号！"),$.page("bindPhone",-1,!0)}!$.$.loginUrl||$.$.loginUrl.indexOf("techReward&")==-1&&$.$.loginUrl.indexOf("comment&")==-1&&$.$.loginUrl.indexOf("confirmOrder&")==-1||$.localStorage("backIndex",3),$.$.loginUrl?$.page($.$.loginUrl,-1,!0):$.page("home",-1,!0)},o?500:1)}var s=$("#login-tel"),r=$("#login-password"),n=$("#login-btn"),l=[0,0],i=$("#content>div>div:nth-of-type(3)"),t=!1,u=$.localStorage("con-login-param")?JSON.parse($.localStorage("con-login-param")):window.loginInfo,c=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode;return $.$.payAuthCode=c,!$.$.ua.isWX||c&&"9358_login"==$.getUrlParam("state")?(/^chat/.test($.$.loginUrl)&&$("#content>div>div#title>div:nth-of-type(2)").Click(function(){$.page("home",-1,!0)}),s.Verify("tel",function(o){l[0]=o,e()}),r.Verify("password",function(o){l[1]=o,e()}),n.Click(function(){o()}),$("#recover-password-link").Click(function(){window.loginInfo={username:s.Value()},$.page("recoverPassword")}),$.pageSwitch(),void(u&&u.username&&(s[0].value=u.username,l[0]=!0,r[0].focus(),t=u.isBindWeixin,u.password?(r[0].value=u.password,l[1]=!0,e(),$.localStorageClear("con-login-param"),o()):e()))):void $.getOauthCode("","9358","9358_login","base")}();