!function(){function e(){var e=!1,i=!1;$.ajax({url:"../api/v2/club/paid_service_item/view",isReplaceUrl:!0,data:{id:t},success:function(o){function a(){function e(){if(y[8]>0)y=[y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8]-1],n([8]);else if(y[7]>0)y=[y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7]-1,9],n([7,8]);else if(""==y.join("").replace(/0/g,""))return r&&c?($("#content>div>div:nth-of-type(3)>div:nth-of-type(2)").Text("已结束："),$("#confirmBtn").Class("disabled")):a(),!0;setTimeout(e,10)}function t(){var e=[];if(y[6]>0)y=[y[0],y[1],y[2],y[3],y[4],y[5],y[6]-1,9,9],e=e.concat([6]);else if(y[5]>0)y=[y[0],y[1],y[2],y[3],y[4],y[5]-1,9,9,9],e=e.concat([5,6]);else if(y[4]>0)y=[y[0],y[1],y[2],y[3],y[4]-1,5,9,9,9],e=e.concat([4,5,6]);else if(y[3]>0)y=[y[0],y[1],y[2],y[3]-1,9,5,9,9,9],e=e.concat([3,4,5,6]);else if(y[2]>0)y=[y[0],y[1],y[2]-1,5,9,5,9,9,9],e=e.concat([2,3,4,5,6]);else if(y[1]>0)y=[y[0],y[1]-1,9,5,9,5,9,9,9],e=e.concat([1,2,3,4,5,6]);else if(y[0]>0)y=[y[0]-1,2,4,5,9,5,9,9,9],e=e.concat([0,1,2,3,4,5,6]);else if(""==y.join("").replace(/0/g,""))return r&&c?($("#content>div>div:nth-of-type(3)>div:nth-of-type(2)").Text("已结束："),$("#confirmBtn").Class("disabled")):a(),!0;n(e),setTimeout(t,1e3)}function n(e){e.forEach(function(e){C.Index(e).Text(y[e])})}var o,d,l,f,h,v,u,y,x=(Math.round,Math.floor),g=+new Date,C=($("#content>div>div:nth-of-type(3)>span"),$("#content>div>div:nth-of-type(3)>span")),m=!1;if(s>g)o=s-g,$("#content>div>div:nth-of-type(3)>div:nth-of-type(2)").Text("距开始还剩：");else{if(!(p>g))return r=!0,c=!0,$("#content>div>div:nth-of-type(3)>div:nth-of-type(2)").Text("已结束："),void $("#confirmBtn").Class("disabled");o=p-g,$("#content>div>div:nth-of-type(3)>div:nth-of-type(2)").Text("距结束还剩："),r=!0,i&&$("#confirmBtn").ClassClear("disabled")}d=o/1e3,d>0&&(l=x(o%1e3/10),f=x(d%60),h=x(d/60%60),v=x(d/3600%24),u=x(d/3600/24),y=[u,x(v/10),v%10,x(h/10),h%10,x(f/10),f%10,x(l/10),x(o%10)],C.Index(0).Text(y[0]),C.Index(1).Text(y[1]),C.Index(2).Text(y[2]),C.Index(3).Text(y[3]),C.Index(4).Text(y[4]),C.Index(5).Text(y[5]),C.Index(6).Text(y[6]),C.Index(7).Text(y[7]),C.Index(8).Text(y[8]),0!=u||m||(m=!0,$(".rob-day").Class("hide"),$(".rob-milli").ClassClear("hide"),setTimeout(e,10)),setTimeout(t,o%1e3))}function d(){return $.$.userToken?!!$.$.userTel||($.$.loginUrl=location.hash,$.bindPhone(!0),!1):($.tipShow("请您先登录！"),$.$.loginUrl=location.hash,$.page("login"),!1)}if(200==o.statusCode){o=o.respData,$("#content>div>div:nth-of-type(1)>div>div:nth-of-type(1)").CSS("background-image","url("+$.$.clubLogo+")"),$("#content>div>div:nth-of-type(1)>div>div:nth-of-type(2)").Text($.$.clubName),$("#content>div>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").Text(o.name),o.usePeriod&&(7!=o.usePeriod.match(/(\d)/g).length||o.endTime)&&$("#content>div>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)").ClassClear("hide"),(0==o.canPaidCount||o.canPaidCount-o.paidCount>0)&&(i=!0),$("#content>div>div:nth-of-type(2)>div:nth-of-type(3)>div:nth-of-type(2)").Html(o.canPaidCount>0?"剩余<span>"+(o.canPaidCount-o.paidCount)+"</span>份":"<span>不限份数</span>"),$("#content>div>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(1)").Text(o.amount),$("#content>div>div:nth-of-type(2)>div:nth-of-type(3)>div:nth-of-type(1)>span>span").Text(o.price),o.credits<=0&&$("#content>div>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(2),#content>div>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(3)").Class("hide"),$("#content>div>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(3)>span").Text(o.credits),$.ajax({url:"../api/v2/user/switches",isReplaceUrl:!0,data:{clubId:$.$.clubID},success:function(t){200==t.statusCode&&(t=t.respData,"on"==t.credit.clubSwitch&&"on"==t.credit.systemSwitch&&o.credits>0&&($("#confirmBtn>div:nth-of-type(1)").ClassClear("hide"),e=!0))}});var s=+new Date(o.startDate.replace(/-/g,"/")),p=+new Date(o.endDate.replace(/-/g,"/")),r=!1,c=!1,l="online"==o.status;if(a(),$("#projectExplain>div:nth-of-type(2)>div.explain-item:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(o.useStartDate.split(" ")[0].replace(/-/g,".")+" - "+o.useEndDate.split(" ")[0].replace(/-/g,".")),o.usePeriod&&(7!=o.usePeriod.match(/(\d)/g).length||o.endTime)){var f="仅限";f+="1,2,3,4,5"===o.usePeriod?"工作日（周一至周五）":"6,0"===o.usePeriod?"周末（周六、周日）":7==o.usePeriod.match(/(\d)/g).length?"周一至周日":(o.usePeriod||"").replace(/(\d)/g,function(){return["周日","周一","周二","周三","周四","周五","周六"," 至 "][arguments[1]]}),$("#projectExplain>div:nth-of-type(2)>div.explain-item:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").Text(f+" "+(o.startTime?o.startTime.replace(/:00$/g,"")+":00 - "+o.endTime.replace(/:00$/g,"")+":00":"")+"可用")}else $("#projectExplain>div:nth-of-type(2)>div.explain-item:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)").CSS("display","none");$("#projectExplain>div:nth-of-type(2)>div.explain-item:nth-of-type(2)>div:nth-of-type(2)").Html(o.instructions),$("#projectExplain>div:nth-of-type(2)>div.explain-item:nth-of-type(3)>div:nth-of-type(2)").Text(o.startDate.replace(/-/g,".")+" - "+o.endDate.replace(/-/g,".")),$("#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(1)").CSS("background-image","url("+o.imageUrl+")"),$("#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(1)").Text(o.name),$("#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(1)").Text(o.price+"元/"+o.duration+o.durationUnit),$("#itemExplain>div:nth-of-type(2)>div:nth-of-type(1)>div:nth-of-type(1)>div:nth-of-type(2)>div:nth-of-type(2)>span:nth-of-type(2)").Text(o.pricePlus?o.pricePlus+"元/"+o.durationPlus+o.durationUnit:""),$("#itemExplain>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(2)>div:nth-of-type(1)").Html(o.description||"无"),$("#content>div>div:nth-of-type(1)>div").Click(function(){$.page("home",-1,!0)}),$.$.ua.isWX&&$.X5Config({title:$.$.clubName+"-"+o.name+"限时抢购就等你来",desc:"据说这个项目一般人抢不到，但是我觉得你可以！抢项目，约技师，享人间极乐。",link:o.shareUrl||location.href,imgUrl:o.imageUrl,success:function(){$("#_shareMask",!0).ClassClear("active")},cancel:function(){},fail:function(e){$.tipShow("分享失败！请稍后再试！")}});var h=$("#confirmBtn"),v=$("#confirmBtn>div");l||h.Class("disabled"),v.Index(0).Click(function(){if(!r)return $.tipShow("活动未开始");if(c)return $.tipShow("活动已结束");if(!l)return $.tipShow("活动未上线");if(!h.ClassHave("disabled")&&d())if(e){if(h.ClassHave("processing"))return $.tipShow("购买中，请稍候...");h.Class("processing"),v.Index(0).Class("loading").Text("购买中..."),$.ajax({url:"../api/v2/club/credits/paid/service_item",isReplaceUrl:!0,data:{id:t,techCode:$.$.techInviteCode||$.param("techCode")||"",userCode:$.$.userCode||$.param("userCode")||""},success:function(e){h.ClassClear("processing"),v.Index(0).ClassClear("loading").Text("积分购买"),200==e.statusCode?($.tipShow("支付成功！"),$.page("robProjectSuccess&isIntegral=true&id="+e.respData)):$.tipShow(e.msg||"积分支付失败")}})}else $.tipShow("未开通积分购买")}),v.Index(1).Click(function(){if(!r)return $.tipShow("活动未开始");if(c)return $.tipShow("活动已结束");if(!l)return $.tipShow("活动未上线");if(!h.ClassHave("disabled"))return h.ClassHave("processing")?$.tipShow("购买中，请稍候..."):$.$.ua.isWX?void(d()&&(h.Class("processing"),v.Index(1).Class("loading").Text("购买中..."),$.ajax({url:"../api/v2/wx/pay/paid_service_item/save",isReplaceUrl:!0,type:"post",data:{paidServiceItemId:t,clubId:o.clubId,tradeChannel:"wx",businessChannel:$.getUrlParam("channel")||"link"},success:function(e){function t(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp+"",nonceStr:e.nonceStr,"package":e["package"],signType:e.signType,paySign:e.paySign},function(t){h.ClassClear("processing"),t.err_msg&&t.err_msg.indexOf("ok")>=0?($.tipShow("支付成功！"),$.page("robProjectSuccess&id="+e.payId)):(v.Index(1).ClassClear("loading").Text("现金购买"),$.tipShow("未能成功支付！"),$.ajax({url:"../api/v2/wx/pay/activity/payment/cancel",isReplaceUrl:!0,data:{payId:e.payId},success:function(){}}))})}200==e.statusCode?(e=JSON.parse(e.respData),"undefined"==typeof WeixinJSBridge?doc.addEventListener?doc.addEventListener("WeixinJSBridgeReady",t,!1):doc.attachEvent&&(doc.attachEvent("WeixinJSBridgeReady",t),doc.attachEvent("onWeixinJSBridgeReady",t)):t()):"935801"==e.statusCode?($.localStorage("con-rob-project-param",!0),$.getOauthCode("","9358","confirm-rob-project","base")):($.tipShow(e.msg||"抢项目失败！"),h.ClassClear("processing"),v.Index(1).ClassClear("loading").Text("现金购买"))},error:function(){$.tipShow("error"),h.ClassClear("processing"),v.Index(1).ClassClear("loading").Text("现金购买")}}))):void($.checkAccessMenu("robProjectDetail")&&$.tipShow("请在微信中打开"))}),n&&h[0].click()}else $.tipShow(o.msg||"查询抢项目详情失败")}})}var t=$.param("robProjectId")||$.getUrlParam("robProjectId")||"",i=$.param("code")||$.getUrlParam("code")||$.$.payAuthCode,n=$.sessionStorage("con-rob-project-param");return $.$.payAuthCode=i,t?(n&&i?$.ajax({url:($.$.clubID?"../":"")+"../wx/oauth2/user/openid",type:"post",data:{code:$.$.payAuthCode,scope:"snsapi_base",wxmp:"9358",userType:"user",state:"confirm-order"},success:function(t){if(200==t.statusCode)e();else{if("935801"!=t.statusCode)return $.tipShow(t.msg||"获取openId失败！"),$.pageCancel();$.getOauthCode("","9358","confirm-rob-project","base")}}}):e(),void $.pageSwitch()):($.tipShow("缺少活动ID"),$.pageCancel())}();